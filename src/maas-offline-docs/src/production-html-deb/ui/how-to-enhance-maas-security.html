<!DOCTYPE html>
<html>
  <head>
    <title>How to enhance MAAS security</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to enhance MAAS security</h1>
      <blockquote>
      <p><em>Errors or typos? Topics missing? Hard to read? <a href="https://docs.google.com/forms/d/e/1FAIpQLScIt3ffetkaKW3gDv6FDk7CfUTNYP_HGmqQotSTtj2htKkVBw/viewform?usp=pp_url&entry.1739714854=https://maas.io/docs/enhancing-maas-security" target = "_blank">Let us know.</a></em></p>
      </blockquote>
      <p>This page offers actionable steps for securing your MAAS instance.</p>
      <h2 id="firewalls">Firewalls</h2>
      <p>For a secure MAAS setup, you need to regulate the network ports accessible on your rack controllers. Below is a table outlining the essential TCP ports for MAAS communication:</p>
      <table>
      <colgroup>
      <col style="width: 15%" />
      <col style="width: 84%" />
      </colgroup>
      <thead>
      <tr class="header">
      <th>Port(s)</th>
      <th>Description</th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td><code>5240</code></td>
      <td>HTTP traffic with each region controller. In HA environments, port <code>80</code> is commonly used.</td>
      </tr>
      <tr class="even">
      <td><code>5241</code> - <code>5247</code></td>
      <td>Allocated for MAAS internal services.</td>
      </tr>
      <tr class="odd">
      <td><code>5248</code></td>
      <td>Designated for rack HTTP communication.</td>
      </tr>
      <tr class="even">
      <td><code>5250</code> - <code>5270</code></td>
      <td>Reserved for region workers (RPC).</td>
      </tr>
      </tbody>
      </table>
      <p>To further harden your security, consider configuring your <a href="https://ubuntu.com/server/docs/security-firewall">firewall</a><strong>^</strong> to allow only the ports MAAS uses. For example, if you’re using <code>ufw</code>, the commands would look like:</p>
      <pre class="nohighlight"><code>sudo ufw enable
      sudo ufw default deny incoming
      sudo ufw allow 5240
      sudo ufw allow 5248
      sudo ufw allow 5241:5247/tcp
      sudo ufw allow 5241:5247/udp
      sudo ufw allow 5250:5270/tcp
      sudo ufw allow 5250:5270/udp</code></pre>
      <p>Note that the above commands are illustrative; your specific setup and MAAS version may require different settings. Always refer to the relevant firewall documentation for your system.</p>
      <blockquote>
      <p><strong>Pro tip</strong>: This example assumes you’re using <code>ufw</code> for your firewall settings. Always consult your system-specific firewall manual for the most accurate instructions.</p>
      </blockquote>
      <h2 id="tls-termination">TLS termination</h2>
      <p>Enhancing both security and availability of your MAAS deployment can be achieved by using a TLS-terminating load balancer. For this purpose, we recommend <a href="https://www.haproxy.com">HAProxy</a><strong>^</strong>. This guide outlines how to establish one.</p>
      <details>
      <p><summary>Sidebar: Understanding TLS-terminated load balancing</summary></p>
      <p>Within MAAS, a <a href="https://www.nginx.com/resources/glossary/load-balancing/">load balancer</a> routes incoming Web UI and API requests across several region controllers. This lessens MAAS workload and reduces user request latency. This is usually part of a high-availability (HA) setup, but MAAS also supports other <a href="how-to-enable-high-availability.html">HA configurations</a> for BMC access and DHCP.</p>
      <p>A TLS-terminated load balancer carries out encryption and decryption as close to the edge of the network as possible, in this case, right at the load balancer. While “SSL” is an outdated term, we opt for “TLS,” or <strong>Transport Layer Security</strong>. TLS aims to ensure both privacy and data integrity between multiple applications, achieved through <a href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm">symmetric cryptography</a> and <a href="https://en.wikipedia.org/wiki/Message_authentication_code">message authentication codes</a>.</p>
      </details>
      <h2 id="pem-files">PEM files</h2>
      <p>Firstly, amalgamate your SSL certificate (<code>mysite.com.crt</code>) and key pair (<code>mysite.com.key</code>) into a single PEM file:</p>
      <pre class="nohighlight"><code>cat mysite.com.crt mysite.com.key &gt; mysite.com.pem
      sudo cp mysite.com.pem /etc/ssl/private/</code></pre>
      <p>Depending on your certificate authority, you may also need to include your root and intermediate CA certificates in the same PEM file.</p>
      <h2 id="haproxy">HAProxy</h2>
      <p>To deploy HAProxy, run the following:</p>
      <pre class="nohighlight"><code>sudo apt-get update
      sudo apt-get install haproxy</code></pre>
      <p>Then, modify <code>/etc/haproxy/haproxy.cfg</code>. In the <code>global</code> section, set the maximum number of concurrent connections:</p>
      <pre class="nohighlight"><code>maxconn &lt;number of concurrent connections&gt;</code></pre>
      <p>Additionally, include the following line to configure temporary DHE key sizes:</p>
      <pre class="nohighlight"><code>tune.ssl.default-dh-param 2048</code></pre>
      <p>In the <code>defaults</code> section under <code>mode http</code>, add:</p>
      <pre class="nohighlight"><code>option forwardfor
      option http-server-close</code></pre>
      <p>Finally, specify the frontend and backend settings to manage connections between HAProxy and MAAS:</p>
      <pre class="nohighlight"><code>frontend maas
          bind *:443 ssl crt /etc/ssl/private/mysite.com.pem
          reqadd X-Forwarded-Proto:\ https
          retries 3
          option redispatch
          default_backend maas

      backend maas
          timeout server 90s
          balance source
          hash-type consistent
          server localhost localhost:5240 check
          server maas-api-1 &lt;ip-address-of-a-region-controller&gt;:5240 check
          server maas-api-2 &lt;ip-address-of-another-region-controller&gt;:5240 check</code></pre>
      <p>Apply these changes by restarting HAProxy:</p>
      <pre class="nohighlight"><code>sudo systemctl restart haproxy</code></pre>
      <p>Optional features like <a href="https://www.digitalocean.com/community/tutorials/how-to-implement-ssl-termination-with-haproxy-on-ubuntu-14-04">HAProxy logging</a><strong>^</strong> can also be enabled, depending on your needs.</p>
      <p>You can alternatively <a href="how-to-enable-high-availability.html">bypass SSL</a> without HAProxy.</p>
      <h2 id="logging">Logging</h2>
      <p>Four types of log files can assist in pinpointing security problems:</p>
      <ol type="1">
      <li>Firewall logs</li>
      <li>Web server logs</li>
      <li>MAAS log files</li>
      <li>System log files</li>
      </ol>
      <p>This guide offers insights and references for each category.</p>
      <h2 id="firewalls-1">Firewalls</h2>
      <p>Ubuntu’s Uncomplicated Firewall (<a href="https://wiki.ubuntu.com/UncomplicatedFirewall">UFW</a>) serves as a front-end for <a href="https://help.ubuntu.com/community/IptablesHowTo">iptables</a>. To secure your MAAS setup, regularly review logs located in <code>/var/log/ufw*</code>.</p>
      <p>Identifying security red flags in UFW and iptables logs is more of an art than a science. However, here are some key patterns to help:</p>
      <ul>
      <li>Be wary of traffic probing ports not linked to any application service. Such behaviour often signifies a port scanner in action.</li>
      </ul>
      <pre class="nohighlight"><code>    blocked incoming tcp connection request from 96.39.208.43:8240 to 128.17.92.85:6002</code></pre>
      <ul>
      <li><p>Cross-reference unusual port numbers against databases of <a href="http://www.relevanttechnologies.com/resources_4.asp">known hacker tools</a>.</p></li>
      <li><p>Repeated, failed access attempts from the same domain, IP, or subnet suggest malicious intent.</p></li>
      </ul>
      <pre class="nohighlight"><code>    blocked incoming tcp connection request from 96.39.208.43:49343 to 64.242.119.18:31337</code></pre>
      <ul>
      <li>Messages from within your network may indicate a Trojan horse at play.</li>
      </ul>
      <pre class="nohighlight"><code>    blocked outgoing tcp packet from 192.168.23.100:5240 to 96.38.231.18:443 as FIN:ACK received, but there is no active connection.</code></pre>
      <h2 id="web-server">Web server</h2>
      <p>To analyse web server activity, employ a log analysis tool or inspect raw logs stored in paths like <code>/var/log/httpd/</code> or <code>/var/log/apache2</code>. Things to keep an eye on include:</p>
      <ul>
      <li>Multiple, rapid-fire requests</li>
      <li>Multiple failed login attempts</li>
      <li>Requests for non-existent pages</li>
      <li>Signs of SQL injection and Web shell attempts</li>
      </ul>
      <h2 id="maas-logs">MAAS logs</h2>
      <table>
      <thead>
      <tr class="header">
      <th>Pkg Fmt</th>
      <th>Look for failed logins in…</th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td>Snap</td>
      <td><code>/var/snap/maas/common/log/regiond.log</code></td>
      </tr>
      <tr class="even">
      <td>Packages</td>
      <td><code>/var/log/maas/regiond.log</code></td>
      </tr>
      </tbody>
      </table>
      <p>For example, a legitimate login request might resemble:</p>
      <pre class="nohighlight"><code>    2020-03-31 21:17:56 regiond: [info] 10.132.172.1 GET /MAAS/accounts/login/ HTTP/1.1 --&gt; 200 OK</code></pre>
      <h2 id="postgresql-security">PostgreSQL security</h2>
      <p>PostgreSQL contains secrets, and should be encrypted for maximum protection. You should consider <a href="https://help.ubuntu.com/community/Full_Disk_Encryption_Howto_2019">full disk encryption</a><strong><sup><strong>. Also recommended is <a href="https://www.postgresql.org/docs/current/ssl-tcp.html">TLS encryption between MAAS and PostgreSQL</a></strong></sup></strong>.</p>
      <h2 id="other-steps">Other steps</h2>
      <p>In addition to the items mentioned above, you should be aware of a few other ways to harden MAAS.</p>
      <h2 id="good-passwords">Good passwords</h2>
      <p>You should pick good passwords and store them securely (e.g. in a KeePassX password database). Perform user administration only via the web UI. Only share the <code>maas</code> and <code>root</code> user passwords with administrators.</p>
      <h2 id="permissions">Permissions</h2>
      <p>MAAS configuration files should be set to have permission <code>640</code>: readable by logins belonging to the <code>maas</code> group and writeable only by the <code>root</code> user. Currently, the <code>regiond.conf</code> file contains the login credentials for the PostgreSQL database used by MAAS to keep track of all machines, networks, and configuration.</p>
      <table>
      <thead>
      <tr class="header">
      <th>Pkg Fmt</th>
      <th>chmod 640 on files…</th>
      <th>Final Perms</th>
      <th>Add’l Info</th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td>Snap</td>
      <td><code>/var/snap/maas/current/regiond.conf</code></td>
      <td><code>-rw-r-----</code></td>
      <td><a href="#heading--snaps-and-security">About snap security</a></td>
      </tr>
      <tr class="even">
      <td></td>
      <td><code>/var/snap/maas/current/rackd.conf</code></td>
      <td><code>-rw-r-----</code></td>
      <td></td>
      </tr>
      <tr class="odd">
      <td>Packages</td>
      <td><code>/etc/maas/rackd.conf/regiond.conf</code></td>
      <td><code>-rw-r-----</code></td>
      <td></td>
      </tr>
      <tr class="even">
      <td></td>
      <td><code>/etc/maas/rackd.conf/rackd.conf</code></td>
      <td><code>-rw-r-----</code></td>
      <td></td>
      </tr>
      </tbody>
      </table>
      <h2 id="snap-security">snap security</h2>
      <p>Snaps are fully confined or ‘sandboxed,’ offering inherent security for the enclosed application. For more detailed information, see <a href="https://snapcraft.io/blog/where-eagles-snap-a-closer-look">this snap blog</a><strong>^</strong>.</p>
      <h2 id="shared-secrets">Shared secrets</h2>
      <p>When you add a new rack or region controller, MAAS asks for a shared secret it will use to communicate with the rest of MAAS. This secret is also exposed in the web UI when you click the ‘Add rack controller’ button on the Controllers page. MAAS automatically generates this secret when your first region controller installed, and stores the secret in a plain text file. This file is automatically protected with the correct permissions, so there is no need for any action on your part.</p>
      <p>As a MAAS administrator, it’s crucial to avoid storing secrets associated with your MAAS instance in the database. This includes secrets like the OMAPI key and the RPC secret.</p>
      <h2 id="hashicorp-vault">HashiCorp Vault</h2>
      <p>Beginning with version 3.3, MAAS secrets are stored in <a href="https://www.hashicorp.com/products/vault">HashiCorp Vault</a>.</p>
      <p>Vault employs identity for securing secrets and encryption keys. Its core component is the <code>kv</code> secrets engine, which utilises key-value pairs to store secrets within an encrypted storage managed by Vault. You can explore more about <a href="https://developer.hashicorp.com/vault/docs/secrets">secrets engines</a> if you’re interested.</p>
      <p>Vault safeguards the secrets engine using a <a href="https://developer.hashicorp.com/vault/docs/secrets#barrier-view">barrier view</a>, creating a folder with a randomly-generated UUID as the absolute root directory for that engine. This prevents the engine from accessing secrets outside its UUID folder.</p>
      <p>For detailed information, it’s recommended to refer to the <a href="https://developer.hashicorp.com/vault/docs">Vault documentation</a> and consider <a href="https://developer.hashicorp.com/vault/tutorials/associate-cert">Vault certification</a>.</p>
      <h2 id="security-consulting">Security consulting</h2>
      <p>If you need help implementing MAAS security, please <a href="how-to-contact-us.html">contact us</a>. We will be happy to assist you in arranging security consulting appropriate to your needs.</p>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
