<!DOCTYPE html>
<html>
  <head>
    <title>How to implement TLS</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to implement TLS</h1>
      <blockquote>
      <p><em>Errors or typos? Topics missing? Hard to read? <a href="https://docs.google.com/forms/d/e/1FAIpQLScIt3ffetkaKW3gDv6FDk7CfUTNYP_HGmqQotSTtj2htKkVBw/viewform?usp=pp_url&entry.1739714854=https://maas.io/docs/implementing-maas-native-tls" target = "_blank">Let us know.</a></em></p>
      </blockquote>
      <p>This page explains how to use TLS with MAAS:</p>
      <h2 id="tls-config-3.3">TLS config (3.3++)</h2>
      <p>The maas config-tls command is the go-to utility for managing TLS settings in MAAS. Below is a quick snapshot of the command’s syntax and options:</p>
      <pre class="nohighlight"><code>usage: maas config-tls [-h] COMMAND ...

      Configure MAAS Region TLS.

      optional arguments:
        -h, --help  show this help message and exit

      drill down:
        COMMAND
          enable    Enable TLS and switch to a secured mode (https).
          disable   Disable TLS and switch to a non-secured mode (http).

      the following arguments are required: COMMAND</code></pre>
      <h2 id="enabling-tls">Enabling TLS</h2>
      <p>Activating TLS in MAAS necessitates both a private key and a corresponding X509 certificate. Both items must be in PEM format. Here’s how to enable it:</p>
      <pre class="nohighlight"><code>usage: maas config-tls enable [-h] [--cacert CACERT] [-p PORT] key cert

      positional arguments:
        key                   path to the private key
        cert                  path to certificate in PEM format

      optional arguments:
        -h, --help            show this help message and exit
        --cacert CACERT       path to CA certificates chain in PEM format (default: None)
        -p PORT, --port PORT  HTTPS port (default: 5443)</code></pre>
      <p>By default, the HTTPS port is set to 5443, but you can customise this with the –port option. If you’re using a non-self-signed certificate, you can specify the full certificate chain using the –cacert option.</p>
      <p>If you have HA setup, please note that every MAAS instance will use the same certificate, so you need to create one certificate with multiple domain names or IP addresses; for example:</p>
      <pre class="nohighlight"><code>X509v3 Subject Alternative Name:
                      DNS:example.com, IP Address:10.211.55.9</code></pre>
      <h2 id="disabling-tls">Disabling TLS</h2>
      <p>If for some reason you want to disable TLS, you can do it using the following command:</p>
      <pre class="nohighlight"><code>usage: maas config-tls disable [-h]

      optional arguments:
        -h, --help  show this help message and exit</code></pre>
      <p>After this, MAAS API and UI will be again reachable on port 5240, over plain HTTP.</p>
      <h2 id="tls-via-cli">TLS via CLI</h2>
      <p>To connect to the MAAS API when TLS is enabled, an https URL must be provided to the maas login command, e.g.:</p>
      <pre class="nohighlight"><code>maas login &lt;profile_name&gt; https://mymaas:5443/MAAS &lt;api_key&gt;

      usage: maas login [-h] [--cacerts CACERTS] [-k] profile-name url [credentials]

      Log in to a remote API, and remember its description and credentials.

      positional arguments:
        profile-name       The name with which you will later refer to this remote server and credentials within this tool.
        url                The URL of the remote API, e.g. http://example.com/MAAS/ or http://example.com/MAAS/api/2.0/ if you wish to specify the API
                           version.
        credentials        The credentials, also known as the API key, for the remote MAAS server. These can be found in the user preferences page in
                           the web UI; they take the form of a long random-looking string composed of three parts, separated by colons.

      optional arguments:
        -h, --help         show this help message and exit
        --cacerts CACERTS  Certificate CA file in PEM format
        -k, --insecure     Disable SSL certificate check

      If credentials are not provided on the command-line, they will be prompted
      for interactively.

      the following arguments are required: profile-name, url</code></pre>
      <p>Certificates provided via <code>--cacerts</code> will be stored as a part of your profile and used for next CLI commands invocations.</p>
      <h2 id="certificate-renewal">Certificate renewal</h2>
      <p>Once a certificate has expired, you can update it by running the same command used for enabling TLS:</p>
      <pre class="nohighlight"><code>$ ​​sudo maas config-tls enable new-server-key.pem new-server.pem --port 5443</code></pre>
      <p>If you’re using the snap, the certificate and key must be placed in a directory that’s readable by the CLI, such as <code>/var/snap/maas/common</code> (e.g., if you’re using the snap version).</p>
      <h2 id="is-tls-enabled">Is TLS enabled?</h2>
      <p>When TLS is enabled, the following certificate information is displayed in the MAAS UI under <em>Settings &gt;&gt; Configuration &gt;&gt; Security</em>:</p>
      <ul>
      <li>CN</li>
      <li>Expiration date</li>
      <li>Fingerprint</li>
      <li>Certificate</li>
      </ul>
      <p>If TLS is disabled, this section will instead show a warning. We recommend that you enable TLS for secure communication.</p>
      <h2 id="notifications">Notifications</h2>
      <p>When the specified number of days remain until certificate expiration (as defined in the notification reminder), all administrators will see the certificate expiration notification. This notification enumerates the number of days until certificate expiration. It is dismissible, but once dismissed, it won’t appear again.</p>
      <p>A certificate expiration check runs every twelve hours. When the certificate has expired, the notification will change to “certificate has expired”.</p>
      <h2 id="auto-renew-certs">Auto-renew certs</h2>
      <p>MAAS does not auto-renew certificates, but there’s no reason why we cannot provide a gratuitous example. Use at your own risk.</p>
      <h2 id="local-cert-authority">Local cert authority</h2>
      <p>You can setup your own Certificate Authority (CA) server that supports the ACME protocol with these components:</p>
      <ul>
      <li><a href="https://smallstep.com/docs/step-ca">step-ca from Smallstep</a><strong>^</strong></li>
      <li><a href="https://caddyserver.com/docs/caddyfile/directives/acme_server">Caddy server with ACME support</a> (available since version 2.5)<strong>^</strong></li>
      </ul>
      <p>If you have a CA server with ACME protocol support, you can use any ACME client for an automated certificate renewal and use crontab to renew on a desired time interval. Consider <a href="https://github.com/acmesh-official/acme.sh">acme.sh</a><strong>^</strong>:</p>
      <pre class="nohighlight"><code>$&gt; acme.sh --issue -d mymaas.internal --standalone --server https://ca.internal/acme/acme/directory

      Your cert is in: /root/.acme.sh/mymaas.internal/mymaas.internal.cer
      Your cert key is in: /root/.acme.sh/mymaas.internal/mymaas.internal.key
      The intermediate CA cert is in: /root/.acme.sh/mymaas.internal/ca.cer
      And the full chain certs is there: /root/.acme.sh/foo/fullchain.cer</code></pre>
      <p>Once the certificate is issued, you can install it.</p>
      <pre class="nohighlight"><code>$&gt; acme.sh --installcert -d maas.internal \
         --certpath /var/snap/maas/certs/server.pem \
         --keypath /var/snap/maas/certs/server-key.pem  \
         --capath  /var/snap/maas/certs/cacerts.pem  \
         --reloadcmd  &quot;(echo y) | maas config-tls enable /var/snap/maas/certs/server-key.pem /var/snap/maas/certs/server.pem --port 5443&quot;</code></pre>
      <p>Please note that if you have MAAS installed via snap, you need to run above command as root, in order to place cert and key under <code>/var/snap/maas</code>.</p>
      <p>Another approach would be to write a bash script and pass it to a <a href="https://github.com/acmesh-official/acme.sh/wiki/Using-pre-hook-post-hook-renew-hook-reloadcmd"><code>--renew-hook</code></a><strong>^</strong>.</p>
      <h2 id="using-certbot">Using certbot</h2>
      <p><a href="https://certbot.eff.org">certbot</a><strong>^</strong> can be used to renew certificates and execute a post-renewal hook. We can use this hook to re-configure MAAS to use fresh certificates.</p>
      <p>To create a post-renewal hook, you can put this sample script under <code>/etc/letsencrypt/renewal-hooks/post/001-update-maas.sh</code>.</p>
      <pre class="nohighlight"><code>#!/bin/bash -e

      DOMAIN=&quot;maas.internal&quot;
      CERTSDIR=&quot;/etc/letsencrypt/live/$DOMAIN&quot;

      cd /var/snap/maas/common

      # need to copy certs where the snap can read them
      cp &quot;$CERTSDIR&quot;/{privkey,cert,chain}.pem .
      yes | maas config-tls enable privkey.pem cert.pem --cacert chain.pem --port 5443

      # we don’t want to keep private key and certs around
      rm {privkey,cert,chain}.pem</code></pre>
      <p>Don’t forget to make the script executable:</p>
      <pre class="nohighlight"><code>chmod +x /etc/letsencrypt/renewal-hooks/post/001-update-maas.sh</code></pre>
      <p>Of course, you’ll first need to obtain a new certificate.</p>
      <pre class="nohighlight"><code>sudo REQUESTS_CA_BUNDLE=ca.pem certbot certonly --standalone -d maas.internal     --server https://ca.internal/acme/acme/directory</code></pre>
      <p>Don’t worry, new certs will not run the hook, since hooks are run only on renewal.</p>
      <p>To test the renewal process and verify that the hook is executed correctly, you can use the following command with a <code>--dry-run flag</code>. Please note, that the hook will be executed and existing certificates will be removed (if you are using an example hook script):</p>
      <pre class="nohighlight"><code>sudo REQUESTS_CA_BUNDLE=ca.pem certbot renew --standalone --server https://ca.internal/acme/acme/directory --dry-run</code></pre>
      <p>Please refer to the <a href="https://certbot.eff.org/instructions?ws=other&amp;os=ubuntufocal">certbot documentation</a><strong>^</strong> for more information.</p>
      <h2 id="tls-for-maas-3.2">TLS for MAAS 3.2–</h2>
      <p>MAAS doesn’t support TLS encryption natively. If you are not interested in <a href="how-to-enable-high-availability.html">setting up an HAProxy</a> which users access directly. The examples below explain how to create this configuration.</p>
      <p>Note that MAAS doesn’t bind to port 80; instead, MAAS binds to port 5240.</p>
      <h2 id="nginx-config">nginx config</h2>
      <pre class="nohighlight"><code>    server {
           listen 443 SQL;

           server_name _;
           ssl_certificate /etc/nginx/ssl/nginx.crt;
           ssl_certificate_key /etc/nginx/ssl/nginx.key;

           location / {
            proxy_pass http://localhost:5240;
            include /etc/nginx/proxy_params;
           }

           location /MAAS/ws {
            proxy_pass http://localhost:5240/MAAS/ws;
                          proxy_http_version 1.1;
                          proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;Upgrade&quot;;
           }
          }</code></pre>
      <h2 id="apache2-config">apache2 config</h2>
      <pre class="nohighlight"><code>    &lt;VirtualHost *:443&gt;
           SSLEngine On

           SSLCertificateFile /etc/apache2/ssl/apache2.crt
           SSLCertificateKeyFile /etc/apache2/ssl/apache2.key

           RewriteEngine On
                  RewriteCond %{REQUEST_URI} ^/MAAS/ws [NC]
                  RewriteRule /(.*) ws://localhost:5240/MAAS/ws [P,L]

                  ProxyPreserveHost On
                  ProxyPass / http://localhost:5240/
                  ProxyPassReverse / http://localhost:5240/
          &lt;/VirtualHost&gt;</code></pre>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
