<!DOCTYPE html>
<html>
  <head>
    <title>How to troubleshoot common issues</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to troubleshoot common issues</h1>
      <blockquote>
      <p><em>Errors or typos? Topics missing? Hard to read? <a href="https://docs.google.com/forms/d/e/1FAIpQLScIt3ffetkaKW3gDv6FDk7CfUTNYP_HGmqQotSTtj2htKkVBw/viewform?usp=pp_url&entry.1739714854=https://maas.io/docs/troubleshooting-common-maas-issues" target = "_blank">Let us know.</a></em></p>
      </blockquote>
      <h2 id="netplan-configuration-ignored-when-deploying-a-machine">Netplan configuration ignored when deploying a machine</h2>
      <p><strong>Problem:</strong> The Netplan configuration provided in the <code>cloud-init</code> script is being ignored, resulting in static IP settings instead of the desired DHCP configuration.</p>
      <p><strong>Solution:</strong> To ensure the network configuration is correctly applied during deployment, follow these steps:</p>
      <ol type="1">
      <li><p><strong>Edit machine’s interfaces in MAAS:</strong></p>
      <ul>
      <li>Before deploying the machine, edit the machine’s network interfaces in MAAS to set the IP mode to DHCP. This avoids the need for <code>cloud-init</code> to handle network configuration.</li>
      </ul></li>
      <li><p><strong>Default DHCP for future machines:</strong></p>
      <ul>
      <li>While it’s not currently possible to make DHCP the default for all future machines in MAAS, you can include this configuration as part of your deployment automation.</li>
      </ul></li>
      <li><p><strong>Custom <code>cloud-init</code> script:</strong></p>
      <ul>
      <li>If you still prefer to use a <code>cloud-init</code> script, ensure it correctly sets up the network interfaces. However, due to current limitations, you may need a workaround to apply Netplan configuration.</li>
      </ul></li>
      <li><p><strong>Workaround with bash script:</strong></p>
      <ul>
      <li>Use a bash script within <code>cloud-init</code> to manually write the Netplan configuration and apply it. This can be done using the <code>runcmd</code> section of the <code>cloud-init</code> script.</li>
      </ul>
      <p>Example <code>cloud-init</code> script with bash workaround:</p>
      <div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">#cloud-config</span></span>
      <span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="fu">packages</span><span class="kw">:</span></span>
      <span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> qemu-guest-agent</span></span>
      <span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> openssh-server</span></span>
      <span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
      <span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="fu">users</span><span class="kw">:</span></span>
      <span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> default</span></span>
      <span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> untouchedwagons</span></span>
      <span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="at">    </span><span class="fu">gecos</span><span class="kw">:</span><span class="at"> untouchedwagons</span></span>
      <span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="at">    </span><span class="fu">primary_group</span><span class="kw">:</span><span class="at"> untouchedwagons</span></span>
      <span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="at">    </span><span class="fu">groups</span><span class="kw">:</span><span class="at"> sudo</span></span>
      <span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="at">    </span><span class="fu">sudo</span><span class="kw">:</span><span class="at"> ALL=(ALL) NOPASSWD:ALL</span></span>
      <span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="at">    </span><span class="fu">shell</span><span class="kw">:</span><span class="at"> /bin/bash</span></span>
      <span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="at">    </span><span class="fu">ssh_import_id</span><span class="kw">:</span></span>
      <span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a><span class="at">      </span><span class="kw">-</span><span class="at"> gh:UntouchedWagons</span></span>
      <span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a></span>
      <span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="fu">runcmd</span><span class="kw">:</span></span>
      <span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="kw">[</span><span class="at"> systemctl</span><span class="kw">,</span><span class="at"> enable</span><span class="kw">,</span><span class="at"> --now</span><span class="kw">,</span><span class="at"> qemu-guest-agent </span><span class="kw">]</span></span>
      <span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="kw">[</span><span class="at"> systemctl</span><span class="kw">,</span><span class="at"> enable</span><span class="kw">,</span><span class="at"> --now</span><span class="kw">,</span><span class="at"> ssh </span><span class="kw">]</span></span>
      <span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="kw">  - </span><span class="ch">|</span></span>
      <span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>    cat &lt;&lt;EOF &gt; /etc/netplan/01-netcfg.yaml</span>
      <span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>    network:</span>
      <span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>      version: 2</span>
      <span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>      ethernets:</span>
      <span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>        ens18:</span>
      <span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>          match:</span>
      <span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>            macaddress: &#39;bc:24:11:e5:41:b7&#39;</span>
      <span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>          dhcp4: true</span>
      <span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>          dhcp-identifier: mac</span>
      <span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>    EOF</span>
      <span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>    netplan apply</span></code></pre></div></li>
      <li><p><strong>Automation integration:</strong></p>
      <ul>
      <li>Integrate these configurations into your existing automation framework (e.g., Ansible, Terraform) to ensure consistent and repeatable deployments.</li>
      </ul></li>
      </ol>
      <p>By following these steps, you can ensure that the network configuration is applied correctly during machine deployment in MAAS, avoiding the issues with ignored Netplan settings.</p>
      <h2 id="pre-registering-machine-with-ipmi-address-as-fqdn">Pre-registering machine with IPMI address as FQDN</h2>
      <p><strong>Problem:</strong> Users encounter issues when trying to set the IPMI IP address field as an FQDN in MAAS. The machine gets registered with an IPv4 address associated with the FQDN, and the commissioning process does not complete.</p>
      <p><strong>Solution:</strong> To address this issue and implement workarounds, follow these steps:</p>
      <ol type="1">
      <li><p><strong>Direct FQDN usage:</strong></p>
      <ul>
      <li>Currently, MAAS does not support using FQDN directly for the <code>power_address</code> field. The <code>power_address</code> must be an IPv4 or IPv6 address as per the BMC enlistment documentation.</li>
      </ul></li>
      <li><p><strong>Workarounds:</strong></p>
      <p><strong>a. Use Unique hostnames in the cluster:</strong></p>
      <ul>
      <li>Ensure each machine in the cluster has a unique hostname. This can help in distinguishing and managing machines more effectively.</li>
      </ul>
      <p><strong>b. Assign FQDN management hostnames:</strong></p>
      <ul>
      <li>Assign a unique management FQDN to the BMC/IPMI IP of each machine. For example, use <code>[hostname]-mgmt</code> as the FQDN for the IPMI address.</li>
      </ul>
      <p><strong>c. Update BMC IP using Python script:</strong></p>
      <ul>
      <li>Write a Python script that updates the BMC IP address for each machine using the MAAS API. Schedule this script to run periodically (e.g., every 5 minutes) using <code>cron</code>.</li>
      </ul>
      <p>Example Python script:</p>
      <div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="im">import</span> maas.client</span>
      <span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="im">from</span> maas.client <span class="im">import</span> login</span>
      <span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="im">from</span> maas.client.enum <span class="im">import</span> NodeStatus</span>
      <span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a></span>
      <span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>MAAS_API_URL <span class="op">=</span> <span class="st">&#39;http://&lt;MAAS_SERVER&gt;/MAAS/&#39;</span></span>
      <span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>API_KEY <span class="op">=</span> <span class="st">&#39;&lt;YOUR_API_KEY&gt;&#39;</span></span>
      <span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>FQDN_SUFFIX <span class="op">=</span> <span class="st">&#39;-mgmt&#39;</span></span>
      <span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a></span>
      <span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a><span class="kw">def</span> update_bmc_ips():</span>
      <span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>    client <span class="op">=</span> login(MAAS_API_URL, API_KEY)</span>
      <span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>    nodes <span class="op">=</span> client.machines.<span class="bu">list</span>(status<span class="op">=</span>NodeStatus.READY)</span>
      <span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>    <span class="cf">for</span> node <span class="kw">in</span> nodes:</span>
      <span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>        hostname <span class="op">=</span> node.hostname</span>
      <span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>        fqdn <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>hostname<span class="sc">}{</span>FQDN_SUFFIX<span class="sc">}</span><span class="ss">&quot;</span></span>
      <span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>        ip_address <span class="op">=</span> socket.gethostbyname(fqdn)</span>
      <span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>        node.power_address <span class="op">=</span> ip_address</span>
      <span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>        node.save()</span>
      <span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a></span>
      <span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
      <span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>    update_bmc_ips()</span></code></pre></div>
      <ul>
      <li><p>Add the script to <code>crontab</code> to run every 5 minutes:</p>
      <div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">*/5</span> * * * * /usr/bin/python3 /path/to/update_bmc_ips.py</span></code></pre></div></li>
      </ul></li>
      </ol>
      <p>By following these steps, users can manage their MAAS setup more effectively, even when direct FQDN usage is not supported for IPMI addresses. The provided workarounds ensure that the IPMI addresses are updated and managed correctly using the MAAS API and periodic scripts.</p>
      <h2 id="automating-initial-configuration-settings-for-new-machines">Automating initial configuration settings for new machines</h2>
      <p><strong>Problem:</strong> Users need to manually configure network interfaces to DHCP and set power configurations to Manual for new machines added to MAAS, seeking a way to automate these settings.</p>
      <p><strong>Solution:</strong> To automate the initial configuration settings for new machines in MAAS, follow these steps:</p>
      <ol type="1">
      <li><p><strong>Use preseed scripts:</strong></p>
      <ul>
      <li>Utilize MAAS preseed scripts to automate network and power configurations. Preseed scripts can run commands during different stages of machine deployment.</li>
      </ul></li>
      <li><p><strong>Curtin userdata:</strong></p>
      <ul>
      <li>Modify <code>curtin_userdata</code> to include early commands for setting network interfaces to DHCP and power configuration to Manual. Add these configurations to the preseed file.</li>
      </ul>
      <p>Example preseed configuration:</p>
      <div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="fu">early_commands</span><span class="kw">:</span></span>
      <span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="fu">  10_dhcp</span><span class="kw">: </span><span class="ch">|</span></span>
      <span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    for nic in $(ls /sys/class/net/ | grep -v lo); do</span>
      <span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>      echo &quot;dhclient ${nic}&quot; &gt;&gt; /etc/network/interfaces.d/${nic};</span>
      <span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>      dhclient ${nic}</span>
      <span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    done</span>
      <span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="fu">  20_power</span><span class="kw">: </span><span class="ch">|</span></span>
      <span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    echo &quot;manual&quot; &gt; /etc/maas/power.conf</span></code></pre></div></li>
      <li><p><strong>MAAS CLI:</strong></p>
      <ul>
      <li>Use the MAAS CLI to automate the setting of DHCP and power configuration for newly added machines. Create a script to be run after the machine is added to MAAS.</li>
      </ul>
      <p>Example script:</p>
      <div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">#!/bin/bash</span></span>
      <span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="va">MACHINE_ID=$1</span></span>
      <span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a></span>
      <span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co"># Set network interface to DHCP</span></span>
      <span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="ex">maas</span> admin interface link-subnet <span class="va">$MACHINE_ID</span> <span class="kw">\</span></span>
      <span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  <span class="va">$(</span><span class="ex">maas</span> admin interfaces read <span class="va">$MACHINE_ID</span> <span class="kw">|</span> <span class="ex">jq</span> <span class="st">&#39;.[0].id&#39;</span><span class="va">)</span> <span class="kw">\</span></span>
      <span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>  <span class="va">mode=</span>DHCP</span>
      <span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a></span>
      <span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="co"># Set power configuration to Manual</span></span>
      <span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a><span class="ex">maas</span> admin machine update <span class="va">$MACHINE_ID</span> power_type=manual</span></code></pre></div></li>
      <li><p><strong>Automate through hooks:</strong></p>
      <ul>
      <li>Use MAAS hooks to trigger the script whenever a new machine is added. Hooks can be configured to execute scripts based on specific events.</li>
      </ul></li>
      <li><p><strong>Check certified hardware:</strong></p>
      <ul>
      <li>Ensure that the hardware being added to MAAS is certified and recognized by MAAS. This helps in automatic detection and configuration.</li>
      </ul></li>
      <li><p><strong>Custom automation:</strong></p>
      <ul>
      <li>Integrate these steps into your existing automation framework if you have one. Tools like Ansible, Terraform, or custom scripts can be used to manage these configurations.</li>
      </ul></li>
      </ol>
      <p>By implementing these steps, users can automate the initial configuration settings for new machines in MAAS, reducing manual intervention and streamlining the deployment process.</p>
      <h2 id="vlan-issues-and-rack-controller-configuration">VLAN issues and rack controller configuration</h2>
      <p><strong>Problem:</strong> Users encounter issues with VLANs not being utilized on any rack controller, leading to problems with DHCP and network connectivity.</p>
      <p><strong>Solution:</strong> To troubleshoot and resolve VLAN issues in MAAS, follow these steps:</p>
      <ol type="1">
      <li><strong>Configure VLAN interfaces:</strong>
      <ul>
      <li><p>Ensure that VLAN interfaces are correctly configured on the rack controller with proper IDs, links, and IP addresses. Use <code>netplan</code> to apply configurations:</p>
      <div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="fu">sudo</span> netplan apply</span></code></pre></div></li>
      </ul></li>
      <li><strong>Define subnets properly:</strong>
      <ul>
      <li>Verify that subnets are defined correctly in MAAS for each VLAN. Check that the network, gateway, and DNS information are accurately entered.</li>
      </ul></li>
      <li><strong>Physical connections:</strong>
      <ul>
      <li>Confirm that the rack controller is physically connected to the appropriate networks and VLANs. If using a managed switch, ensure that ports are configured for the correct VLANs.</li>
      </ul></li>
      <li><strong>Check MAAS logs:</strong>
      <ul>
      <li><p>Review rack controller logs for any errors related to VLANs or DHCP:</p>
      <div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="fu">tail</span> -f /var/log/maas/*.log</span></code></pre></div></li>
      </ul></li>
      <li><strong>Force network re-detection:</strong>
      <ul>
      <li>Remove and re-add the rack controller in MAAS to force it to re-detect available networks and VLANs.</li>
      </ul></li>
      <li><strong>Test DHCP on single VLAN:</strong>
      <ul>
      <li>Enable DHCP on one VLAN at a time to identify any working configurations.</li>
      </ul></li>
      <li><strong>Static IP address:</strong>
      <ul>
      <li>Consider setting a static IP address on the VLAN interface to avoid DHCP conflicts.</li>
      </ul></li>
      <li><strong>Restart rack controller:</strong>
      <ul>
      <li>Restart the rack controller to ensure it reconnects correctly to MAAS and the VLANs.</li>
      </ul></li>
      <li><strong>Reinstall rack controller:</strong>
      <ul>
      <li>As a last resort, reinstall the rack controller following the official documentation to resolve any networking issues:
      <ul>
      <li>Ensure the rack controller is not installed on the same machine as the region controller.</li>
      </ul></li>
      </ul></li>
      <li><strong>DHCP forwarding considerations:</strong>
      <ul>
      <li>If using DHCP forwarding on the router, ensure that the rack servers on the VLAN can still communicate with the DHCP server.</li>
      </ul></li>
      </ol>
      <p>By following these steps, users can troubleshoot and resolve issues with VLAN utilization on rack controllers in MAAS, ensuring proper network configuration and connectivity.</p>
      <h2 id="releasing-old-dhcp-leases">Releasing old DHCP leases</h2>
      <p><strong>Problem:</strong> Deploying servers in MAAS results in an error stating “No more IPs available in subnet,” despite having unused IP addresses.</p>
      <p><strong>Solution:</strong> To release old DHCP leases and resolve IP allocation issues, follow these steps:</p>
      <ol type="1">
      <li><strong>Check for orphaned IP addresses:</strong>
      <ul>
      <li><p>Run the following SQL query to identify orphaned IP addresses in the MAAS database:</p>
      <div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>sudo <span class="op">-</span>u postgres psql <span class="op">-</span>d maasdb <span class="op">-</span>c <span class="ot">&quot;</span></span>
      <span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="fu">count</span>(<span class="op">*</span>)</span>
      <span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="kw">FROM</span> maasserver_staticipaddress</span>
      <span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> maasserver_interface_ip_addresses <span class="kw">ON</span> maasserver_staticipaddress.<span class="kw">id</span> <span class="op">=</span> maasserver_interface_ip_addresses.staticipaddress_id</span>
      <span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> maasserver_interface <span class="kw">ON</span> maasserver_interface.<span class="kw">id</span> <span class="op">=</span> maasserver_interface_ip_addresses.interface_id</span>
      <span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="kw">WHERE</span> maasserver_staticipaddress.ip <span class="kw">IS</span> <span class="kw">NULL</span> </span>
      <span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  <span class="kw">AND</span> maasserver_interface.<span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;unknown&#39;</span> </span>
      <span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>  <span class="kw">AND</span> maasserver_staticipaddress.alloc_type <span class="op">=</span> <span class="dv">6</span>;</span>
      <span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a><span class="ot">&quot;</span></span></code></pre></div></li>
      <li><p>This will help you identify any orphaned addresses that are not properly allocated.</p></li>
      </ul></li>
      <li><strong>Clean neighbor discoveries:</strong>
      <ul>
      <li><p>Use the MAAS CLI to clear discovered neighbors, which might be causing IP conflicts:</p>
      <div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="ex">maas</span> admin discoveries clear all=True -k</span></code></pre></div></li>
      </ul></li>
      <li><strong>Verify cleared discoveries:</strong>
      <ul>
      <li><p>After clearing, check if the discoveries were successfully removed:</p>
      <div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="ex">maas</span> admin discoveries read -k</span></code></pre></div></li>
      </ul></li>
      <li><strong>Clear ARP table (optional):</strong>
      <ul>
      <li><p>If necessary, clear the ARP table on the Rack server to ensure no stale entries exist:</p>
      <div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="ex">arp</span> -d [IP address]</span></code></pre></div></li>
      <li><p>Example to clear all entries:</p>
      <div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="ex">arp</span> -d 172.21.68.79</span>
      <span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="ex">arp</span> -d 172.21.68.69</span></code></pre></div></li>
      </ul></li>
      <li><strong>Run deployment again:</strong>
      <ul>
      <li><p>Attempt to deploy the server again to check if the issue persists. If the error still occurs, check the discoveries once more without cleaning:</p>
      <div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="ex">maas</span> admin discoveries read -k</span></code></pre></div></li>
      </ul></li>
      </ol>
      <p>By following these steps, users can release old DHCP leases and address IP exhaustion issues in MAAS, ensuring successful server deployment.</p>
      <h2 id="configuring-loopback-addresses">Configuring loopback addresses</h2>
      <p><strong>Problem:</strong> Configuring the loopback interface (lo) using MAAS is not straightforward, especially when deploying nodes for use with Free Range Routing (FRR) and BGP.</p>
      <p><strong>Solution:</strong> To configure loopback addresses in MAAS, follow these steps:</p>
      <ol type="1">
      <li><strong>Understand loopback interface:</strong>
      <ul>
      <li>Loopback interfaces do not require MAC addresses since they are used for internal routing within the node itself.</li>
      </ul></li>
      <li><strong>Manually add loopback interface:</strong>
      <ul>
      <li>After commissioning a node, manually add the loopback interface in MAAS.</li>
      <li>If the MAAS web UI requires a MAC address for the loopback interface, use a placeholder value like <code>00:00:00:00:00:00</code> but ensure it does not conflict with other nodes.</li>
      </ul></li>
      <li><strong>Avoid duplicate MAC addresses:</strong>
      <ul>
      <li>Since MAAS does not support duplicate MAC addresses, manually configure the loopback interface on each node with a unique identifier or find a way to bypass the MAC address requirement.</li>
      </ul></li>
      <li><strong>Alternative methods:</strong>
      <ul>
      <li>If manually adding the loopback interface in MAAS is problematic, consider configuring the loopback interface outside of MAAS using post-deployment scripts.</li>
      <li>Use MAAS to deploy the base configuration, then apply custom network configurations (including loopback interfaces) through cloud-init or other automation tools.</li>
      </ul></li>
      <li><strong>Feedback from support:</strong>
      <ul>
      <li>Internal support teams may have additional methods or patches to address this issue. Reach out to MAAS support for the latest solutions or updates regarding loopback interface configuration.</li>
      </ul></li>
      </ol>
      <p>By following these steps, users can effectively configure loopback interfaces on nodes managed by MAAS, facilitating advanced network setups like L3 routing and BGP.</p>
      <h2 id="shrinking-dynamic-ip-range">Shrinking dynamic IP range</h2>
      <p><strong>Problem:</strong> Users may encounter errors when attempting to shrink the dynamic IP address range in MAAS due to conflicts with existing IP addresses or ranges.</p>
      <p><strong>Solution:</strong> To troubleshoot and resolve this issue, follow these steps:</p>
      <ol type="1">
      <li><strong>Check current IP ranges and static addresses:</strong>
      <ul>
      <li><p>Use the following SQL queries to check the current IP ranges and static IP addresses in the MAAS database:</p>
      <div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> maasserver_iprange;</span>
      <span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> maasserver_staticipaddress <span class="kw">WHERE</span> text(ip) <span class="kw">LIKE</span> <span class="st">&#39;192.168.0.%&#39;</span> <span class="kw">ORDER</span> <span class="kw">BY</span> ip;</span></code></pre></div></li>
      <li><p>Identify any existing IP addresses that may conflict with the desired new range.</p></li>
      </ul></li>
      <li><strong>Identify sticky addresses:</strong>
      <ul>
      <li>Identify any sticky addresses within the current range that may cause conflicts. Sticky addresses are IP addresses allocated by MAAS DHCP that persist over reboots.</li>
      </ul></li>
      <li><strong>Adjust IP range:</strong>
      <ul>
      <li>Ensure that the new IP range does not overlap with any existing reserved or sticky addresses. Modify the start and end IP addresses to avoid conflicts.</li>
      <li>Example: If the current range is 192.168.0.194 - 192.168.0.220 and sticky addresses occupy 192.168.0.195 - 192.168.0.211, adjust the range to avoid these addresses.</li>
      </ul></li>
      <li><strong>Update MAAS configuration:</strong>
      <ul>
      <li>After identifying a non-conflicting range, update the MAAS configuration to reflect the new IP range.</li>
      </ul></li>
      <li><strong>Database updates:</strong>
      <ul>
      <li>If necessary, manually update the IP range in the MAAS database to ensure consistency. Make sure to backup the database before making any changes.</li>
      </ul></li>
      </ol>
      <p>By following these steps, users can effectively shrink the dynamic IP address range in MAAS without encountering conflicts with existing IP addresses or ranges.</p>
      <h2 id="overlapping-subnets-can-break-deployments">Overlapping subnets can break deployments</h2>
      <p>Ensure that your subnets don’t overlap to avoid deployment failures. Check and delete any outdated or redundant subnets through the Web UI.</p>
      <h2 id="need-to-reconfigure-server-ip-address">Need to reconfigure server IP address</h2>
      <p>If you need to modify your MAAS server’s IP, simply re-run the setup:</p>
      <pre class="nohighlight"><code>sudo dpkg-reconfigure maas-region-controller</code></pre>
      <h2 id="network-booting-ibm-power-servers">Network booting IBM Power servers</h2>
      <p>IBM Power servers with OPAL firmware utilise Petitboot for PXE interactions. For smooth deployment, configure a specific NIC as the network boot device via Petitboot.</p>
      <h2 id="resolve-dns-conflicts-between-lxd-and-maas">Resolve DNS conflicts between LXD and MAAS</h2>
      <p>If both MAAS and LXD are managing DNS, disable LXD’s DNS and DHCP:</p>
      <pre class="nohighlight"><code>lxc network set $LXD_BRIDGE_NAME dns.mode=none
      lxc network set $LXD_BRIDGE_NAME ipv4.dhcp=false
      lxc network set $LXD_BRIDGE_NAME ipv6.dhcp=false</code></pre>
      <h2 id="nodes-hang-on-commissioning">Nodes hang on “Commissioning”</h2>
      <p><strong>Timing issues</strong>: Make sure the hardware clocks on your nodes and MAAS server are synchronised.</p>
      <p><strong>Network drivers</strong>: Use Linux-compatible network adaptors if commissioning hangs due to driver issues.</p>
      <p>Feel free to contribute additional issues and solutions.</p>
      <h2 id="command-packer-not-found">Command ‘packer’ not found</h2>
      <p>When you try to run <code>packer</code> or execute a <code>make</code> command, you may encounter an error message indicating that <code>packer</code> is not installed. The issue can be resolved by <a href="how-to-customise-images.html">referring to this section</a>.</p>
      <h2 id="error-with-packer">Error with <code>packer</code>:</h2>
      <pre class="nohighlight"><code>stormrider@neuromancer:~$ packer
      Command &#39;packer&#39; not found...</code></pre>
      <h2 id="error-with-make">Error with <code>make</code>:</h2>
      <pre class="nohighlight"><code>stormrider@neuromancer:~/mnt/Dropbox/src/git/packer-maas/ubuntu$ make
      sudo: packer: command not found...</code></pre>
      <h2 id="no-rule-to-make-target-ovmf_vars.fd">No rule to make target …OVMF_VARS.fd</h2>
      <p>Should you see an error like the one below, you’ve forgotten to <a href="how-to-customise-images.html">install a needed dependency</a>.</p>
      <pre class="nohighlight"><code>make: *** No rule to make target &#39;/usr/share/OVMF/OVMF_VARS.fd&#39;...</code></pre>
      <h2 id="failure-to-create-qemu-driver">Failure to create QEMU driver</h2>
      <p>Encountering the following error means you’re missing a dependency. Refer to <a href="how-to-customise-images.html">this section</a> for resolution.</p>
      <pre class="nohighlight"><code>Failed creating Qemu driver: exec: &quot;qemu-img&quot;: executable file not found in $PATH</code></pre>
      <h2 id="timeout-changes-not-taking-effect">Timeout changes not taking effect</h2>
      <p>If you’ve modified the session timeout settings in the MAAS web interface but don’t see the changes, do the following:</p>
      <ol type="1">
      <li>Make sure you’ve got administrative access to the MAAS web interface for changing session timeout settings.</li>
      <li>After altering the session timeout duration, don’t forget to save the new settings.</li>
      <li>Clear your browser’s cache and cookies. They might be holding on to old settings. Restart your browser and try again.</li>
      </ol>
      <h2 id="users-logged-out-before-timeout-expires">Users logged out before timeout expires</h2>
      <p>If users are getting logged out before the session timeout you’ve set, consider these checks:</p>
      <ol type="1">
      <li>Double-check the unit of time you’ve set for the session timeout (weeks, days, hours, minutes). A mistake in units can cause unexpected timeouts.</li>
      <li>Inspect any server settings conflicting with MAAS that may cause premature session timeouts, like window manager logout settings in Ubuntu.</li>
      <li>If you’re using a load balancer or proxy, make sure it’s not causing additional timeouts conflicting with MAAS.</li>
      </ol>
      <h2 id="cant-set-an-infinite-session-timeout">Can’t set an infinite session timeout</h2>
      <p>You can’t set an “infinite” session timeout in MAAS. The maximum allowed duration is 14 days. This limit strikes a balance between security and usability.</p>
      <h2 id="users-are-suddenly-logged-out">Users are suddenly logged out</h2>
      <p>MAAS will auto-logoff users when the session timeout duration is reached. If this happens more often than desired, consider increasing the timeout value to prevent frequent “idle-time” logouts.</p>
      <h2 id="cant-set-different-timeouts-for-user-groups">Can’t set different timeouts for user groups</h2>
      <p>MAAS only supports a global session timeout setting. While you can’t customise this by user group, you could deploy separate MAAS instances with different configurations to achieve similar effects.</p>
      <h2 id="cant-extend-sessions-beyond-the-timeout">Can’t extend sessions beyond the timeout</h2>
      <p>The timeout duration resets every time there’s activity from the user. To extend a session, simply refresh the page before the timeout period ends. This will reset the session timer.</p>
      <h2 id="django-errors">Django errors</h2>
      <p>Sometimes, you may face the following Django error:</p>
      <pre class="nohighlight"><code>django.core.exceptions.ValidationError: [&#39;Subarchitecture(&lt;value&gt;) must be generic when setting hwe_kernel.&#39;]</code></pre>
      <p>To solve this, try specifying a different commissioning kernel—perhaps upgrading from Xenial to Focal.</p>
      <h2 id="forgotten-password">Forgotten password</h2>
      <p>If you forget your MAAS admin password but have sudo privileges, you can reset it like so:</p>
      <pre class="nohighlight"><code>sudo maas changepassword $PROFILE</code></pre>
      <p>Replace <code>$PROFILE</code> with the username.</p>
      <h2 id="missing-web-ui">Missing Web UI</h2>
      <p>The default MAAS web UI is at <code>http://&lt;hostname&gt;:5240/MAAS/</code>. If it’s unreachable:</p>
      <ul>
      <li>Verify Apache is running: <code>sudo /etc/init.d/apache2 status</code>.</li>
      <li>Validate the hostname or try <code>http://127.0.0.1:5240/MAAS/</code>.</li>
      </ul>
      <h2 id="backdoor-image-login">Backdoor image login</h2>
      <p>Ephemeral images boot nodes during MAAS activities. If you need emergency access, you can create a temporary backdoor in these images. This lets you log in to check logs and debug issues.</p>
      <h2 id="extract-the-cloud-image">Extract the cloud image</h2>
      <p>Download the appropriate image and extract its files:</p>
      <pre class="nohighlight"><code>wget https://cloud-images.ubuntu.com/xenial/current/xenial-server-cloudimg-amd64-root.tar.gz
      mkdir xenial
      sudo tar -C xenial -xpSf xenial-server-cloudimg-amd64-root.tar.gz --numeric-owner --xattrs &quot;--xattrs-include=*&quot;</code></pre>
      <h2 id="generate-password-hash">Generate password hash</h2>
      <p>Create a SHA-512 hashed password:</p>
      <pre class="nohighlight"><code>python3 -c &#39;import crypt; print(crypt.crypt(&quot;ubuntu&quot;, crypt.mksalt(crypt.METHOD_SHA512)))&#39;</code></pre>
      <p>Modify the <code>xenial/etc/shadow</code> file to insert this hash.</p>
      <h2 id="rebuild-squashfs-image">Rebuild squashfs image</h2>
      <p>Create a new SquashFS file with your changes:</p>
      <pre class="nohighlight"><code>sudo mksquashfs xenial/ xenial-customized.squashfs -xattrs -comp xz</code></pre>
      <p>Replace the existing MAAS image with this customised one.</p>
      <h2 id="migrating-snap-installs">Migrating snap installs</h2>
      <p>For snap-based MAAS in ‘all’ mode, you can migrate to a local PostgreSQL:</p>
      <pre class="nohighlight"><code>sudo /snap/maas/current/helpers/migrate-vd Snapatabase</code></pre>
      <h2 id="manual-db-export">Manual DB export</h2>
      <p>To manually move your MAAS database, run:</p>
      <pre class="nohighlight"><code>export PGPASS=$(sudo awk -F&#39;:\\s+&#39; &#39;$1 == &quot;database_pass&quot; {print $2}&#39; \
          /var/snap/maas/current/regiond.conf)
      sudo pg_dump -U maas -h /var/snap/maas/common/postgres/sockets \
          -d maasdb -F t -f maasdb-dump.tar</code></pre>
      <p>Stop the MAAS snap (<code>sudo snap stop maas</code>) and create a new PostgreSQL user and database for MAAS on the destination machine.</p>
      <p>This should cover various miscellaneous issues you may encounter while using MAAS. Feel free to contribute with your own experiences.</p>
      <h2 id="leaked-admin-api-key">Leaked admin API key</h2>
      <p>If MAAS hardware sync leaks your admin API key, you can:</p>
      <ul>
      <li>Rotate all admin tokens</li>
      <li>Re-deploy machines with hardware sync enabled</li>
      </ul>
      <p>Or swap the token manually:</p>
      <h2 id="manually-swap-the-maas-admin-api-token">Manually swap the MAAS admin API token</h2>
      <p>Query the database to identify machines with hardware sync enabled:</p>
      <pre class="nohighlight"><code>select system_id 
      from maasserver_node 
      where enable_hw_sync = true;</code></pre>
      <p>Rotate API keys on any affected machines. To verify an API key belongs to an admin, perform this database query:</p>
      <pre class="nohighlight"><code>select u.username, u.email 
      from auth_user u
      left join piston3_consumer c 
      on u.id = c.user_id
      where key = &#39;your-leaked-api-key&#39;;</code></pre>
      <p>To remove the leaked API key, log in to the MAAS UI and delete it. Then reconfigure your MAAS CLI and hardware sync as needed.</p>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
