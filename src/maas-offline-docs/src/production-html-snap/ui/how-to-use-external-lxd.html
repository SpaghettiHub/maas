<!DOCTYPE html>
<html>
  <head>
    <title>How to use external LXD</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to use external LXD</h1>
      <blockquote>
      <p><em>Errors or typos? Topics missing? Hard to read? <a href="https://docs.google.com/forms/d/e/1FAIpQLScIt3ffetkaKW3gDv6FDk7CfUTNYP_HGmqQotSTtj2htKkVBw/viewform?usp=pp_url&entry.1739714854=https://maas.io/docs/managing-vm-hosts" target = "_blank">Let us know.</a></em></p>
      </blockquote>
      <p>In order to deploy a VM host in your MAAS network, you first need to set up a bridge to connect between your VM host and MAAS itself. Once that’s done, you can add and manage VM hosts – and subsequently, create VMs to act as MAAS machines.</p>
      <p>To enable VM host networking features, MAAS must match the VM host IP address of a potential VM host with a known device (a machine or controller). For example, if a machine not known to MAAS is set up as a VM host, enhanced interface selection features will not be available.</p>
      <blockquote>
      <p>It’s essential to enforce usage of IP addresses to avoid domain name conflicts, should different controllers resolve the same domain name with different IP addresses. You should also avoid using 127.0.0.1 when running multiple controllers, as it would confuse MAAS.</p>
      </blockquote>
      <p>If you need some background on VM hosting, we have a <a href="how-to-deploy-virtual-machines.html">refresher</a> available.</p>
      <h2 id="set-up-a-bridge-ui">Set up a bridge (UI)</h2>
      <p>To set up a VM host bridge with the Web UI, select <em>Machines</em> &gt; VM host machine &gt; <em>Network</em> &gt; network to bridge &gt; <em>Create bridge</em>. Fill in the necessary settings and finish with <em>Create bridge</em>.</p>
      <h2 id="set-up-a-bridge-cli">Set up a bridge (CLI)</h2>
      <p>You can also use the MAAS CLI/API to configure a VM host bridge, with the following procedure:</p>
      <ol type="1">
      <li><p>Select the interface you wish to configure the bridge on. This example uses the boot interface, since the boot interface must be connected to a MAAS controlled network – but any interface is allowed:</p>
      <pre><code> INTERFACE_ID=$(maas $PROFILE machine read $SYSTEM_ID | jq .boot_interface.id)</code></pre></li>
      <li><p>Create the bridge:</p>
      <pre><code>  BRIDGE_ID=$(maas $PROFILE interfaces create-bridge $SYSTEM_ID name=br0 parent=$INTERFACE_ID | jq .id)</code></pre></li>
      <li><p>Select the subnet where you want the bridge (this should be a MAAS controlled subnet):</p>
      <pre><code> SUBNET_ID=$(maas $PROFILE subnets read | jq -r &#39;.[] | select(.cidr == &quot;10.0.0.0/24&quot; and .managed == true).id&#39;)</code></pre></li>
      <li><p>Connect the bridge to the subnet:</p>
      <pre><code>   maas $PROFILE interface link-subnet $SYSTEM_ID $BRIDGE_ID subnet=$SUBNET_ID mode=&quot;STATIC&quot; ip_address=&quot;10.0.0.101&quot;</code></pre></li>
      </ol>
      <h2 id="build-a-bridge-netplan">Build a bridge (netplan)</h2>
      <p>You can also use netplan to configure a VM host bridge:</p>
      <p>Open your netplan configuration file. This should be in <code>/etc/netplan</code>. It could be called <code>50-cloud-init.yaml</code>, <code>netplan.yaml</code>, or something else. Modify the file to add a bridge, using the example below to guide you:</p>
      <pre class="nohighlight"><code>network:
          bridges:
              br0:
                  addresses:
                  - 10.0.0.101/24
                  gateway4: 10.0.0.1
                  interfaces:
                  - enp1s0
                  macaddress: 52:54:00:39:9d:f9
                  mtu: 1500
                  nameservers:
                      addresses:
                      - 10.0.0.2
                      search:
                      - maas
                  parameters:
                      forward-delay: 15
                      stp: false
          ethernets:
              enp1s0:
                  match:
                      macaddress: 52:54:00:39:9d:f9
                  mtu: 1500
                  set-name: enp1s0
              enp2s0:
                  match:
                      macaddress: 52:54:00:df:87:ac
                  mtu: 1500
                  set-name: enp2s0
              enp3s0:
                  match:
                      macaddress: 52:54:00:a7:ac:46
                  mtu: 1500
                  set-name: enp3s0
          version: 2</code></pre>
      <p>Apply the new configuration with <code>netplan apply</code>.</p>
      <h2 id="build-a-bridge-libvirt">Build a bridge (libvirt)</h2>
      <p>It is also possible to use <a href="https://ubuntu.com/server/docs/virtualization-libvirt">libvirt</a><strong>^</strong> to configure a virtual bridge. This method will also work for LXD VM hosts running on Ubuntu. Be aware that other methods may be required if you are configuring LXD on an OS other than Ubuntu.</p>
      <p>By default, libvirt creates a virtual bridge, <code>virbr0</code>, through which VMs communicate with each other and the Internet. DHCP, supplied by libvirt, automatically assigns an IP address to each VM. However, to enable network booting in MAAS, you’ll need to provide DHCP in MAAS and either:</p>
      <ul>
      <li>Disable DHCP on libvirt’s <code>default</code> network, or</li>
      <li>Create a new libvirt network <code>maas</code> with DHCP disabled.</li>
      </ul>
      <p>You can set up such a <code>maas</code> network like this:</p>
      <pre class="nohighlight"><code>cat &lt;&lt; EOF &gt; maas.xml
      &lt;network&gt;
       &lt;name&gt;maas&lt;/name&gt;
       &lt;forward mode=&#39;nat&#39;&gt;
         &lt;nat&gt;
           &lt;port start=&#39;1024&#39; end=&#39;65535&#39;/&gt;
         &lt;/nat&gt;
       &lt;/forward&gt;
       &lt;dns enable=&quot;no&quot; /&gt;
       &lt;bridge name=&#39;virbr1&#39; stp=&#39;off&#39; delay=&#39;0&#39;/&gt;
       &lt;domain name=&#39;testnet&#39;/&gt;
       &lt;ip address=&#39;172.16.99.1&#39; netmask=&#39;255.255.255.0&#39;&gt;
       &lt;/ip&gt;
      &lt;/network&gt;
      EOF
      virsh net-define maas.xml</code></pre>
      <p>Note that this network also has NAT port forwarding enabled to allow VMs to communicate with the Internet at large. Port forwarding is very useful in test environments.</p>
      <h2 id="set-up-ssh-for-libvirt">Set up SSH for libvirt</h2>
      <p>For MAAS to successfully communicate with libvirt on your VM host machine – whether you’re running from snap or package, or running rack controllers in LXD containers or on localhost – this example command must succeed from every rack controller:</p>
      <pre class="nohighlight"><code>virsh -c qemu+ssh://$USER@$VM_HOST_IP/system list --all</code></pre>
      <p>Here, <code>$USER</code> is a user on your VM host who is a member of the <code>libvirtd</code> Unix group on the VM host, and <code>$VM_HOST_IP</code> is the IP of your VM host. <strong>Note</strong> that insufficient permissions for <code>$USER</code> may cause the <code>virsh</code> command to fail with an error such as <code>failed to connect to the hypervisor</code>. Check the <code>$USER</code> group membership to make sure <code>$USER</code> is a member of the <code>libvirtd</code> group.</p>
      <h2 id="set-up-libvirt-ssh-3.33.4-snap">Set up libvirt SSH (3.3,3.4 snap)</h2>
      <p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
      <pre class="nohighlight"><code>sudo mkdir -p /var/snap/maas/current/root/.ssh
      cd /var/snap/maas/current/root/.ssh
      sudo ssh-keygen -f id_rsa</code></pre>
      <p>Finally, on the VM host, you’ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>, where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
      <h2 id="set-up-libvirt-ssh-3.33.4-deb">Set up libvirt SSH (3.3,3.4 deb)</h2>
      <p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you’ll need to set up SSH public keys on every rack controller for user <code>maas</code>. First create SSH keys on all rack controllers:</p>
      <pre class="nohighlight"><code>$ sudo -i
      root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
      root@maas:~$ cd /var/snap/maas/current/root/.ssh
      root@maas:~$ ssh-keygen -f id_rsa</code></pre>
      <p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user’s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
      <h2 id="set-up-libvirt-ssh-3.2-snap">Set up libvirt SSH (3.2 snap)</h2>
      <p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
      <pre class="nohighlight"><code>sudo mkdir -p /var/snap/maas/current/root/.ssh
      cd /var/snap/maas/current/root/.ssh
      sudo ssh-keygen -f id_rsa</code></pre>
      <p>Finally, on the VM host, you’ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>, where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
      <h2 id="set-up-libvirt-ssh-3.2-deb">Set up libvirt SSH (3.2 deb)</h2>
      <p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you’ll need to set up SSH public keys on every rack controller for user <code>maas</code>. First create SSH keys on all rack controllers:</p>
      <pre class="nohighlight"><code>$ sudo -i
      root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
      root@maas:~$ cd /var/snap/maas/current/root/.ssh
      root@maas:~$ ssh-keygen -f id_rsa</code></pre>
      <p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user’s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
      <h2 id="set-up-libvirt-ssh-3.1-snap">Set up libvirt SSH (3.1 snap)</h2>
      <p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
      <pre class="nohighlight"><code>sudo mkdir -p /var/snap/maas/current/root/.ssh
      cd /var/snap/maas/current/root/.ssh
      sudo ssh-keygen -f id_rsa</code></pre>
      <p>Finally, on the VM host, you’ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>, where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
      <h2 id="set-up-libvirt-ssh-3.1-deb">Set up libvirt SSH (3.1 deb)</h2>
      <p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you’ll need to set up SSH public keys on every rack controller for user <code>maas</code>. First create SSH keys on all rack controllers:</p>
      <pre class="nohighlight"><code>$ sudo -i
      root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
      root@maas:~$ cd /var/snap/maas/current/root/.ssh
      root@maas:~$ ssh-keygen -f id_rsa</code></pre>
      <p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user’s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
      <h2 id="set-up-libvirt-ssh-3.0-snap">Set up libvirt SSH (3.0 snap)</h2>
      <p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
      <pre class="nohighlight"><code>sudo mkdir -p /var/snap/maas/current/root/.ssh
      cd /var/snap/maas/current/root/.ssh
      sudo ssh-keygen -f id_rsa</code></pre>
      <p>Finally, on the VM host, you’ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>, where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
      <h2 id="set-up-libvirt-ssh-3.0-deb">Set up libvirt SSH (3.0 deb)</h2>
      <p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you’ll need to set up SSH public keys on every rack controller for user <code>maas</code>. First create SSH keys on all rack controllers:</p>
      <pre class="nohighlight"><code>$ sudo -i
      root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
      root@maas:~$ cd /var/snap/maas/current/root/.ssh
      root@maas:~$ ssh-keygen -f id_rsa</code></pre>
      <p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user’s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
      <h2 id="set-up-libvirt-ssh-2.9-snap">Set up libvirt SSH (2.9 snap)</h2>
      <p>If you installed MAAS via snap, then create the needed SSH keys this way:</p>
      <pre class="nohighlight"><code>sudo mkdir -p /var/snap/maas/current/root/.ssh
      cd /var/snap/maas/current/root/.ssh
      sudo ssh-keygen -f id_rsa</code></pre>
      <p>Finally, on the VM host, you’ll need to add <code>id_rsa.pub</code> to the <code>authorized_keys</code> file in <code>/home/&lt;vm-host-user-homedir-name&gt;/.ssh/</code>, where <code>&lt;vm-host-user-homedir-name&gt;</code> is the name of your VM host user.</p>
      <h2 id="set-up-libvirt-ssh-2.9-deb">Set up libvirt SSH (2.9 deb)</h2>
      <p>The <code>maas</code> user on your rack controllers will issue all libvirt commands. Therefore, you’ll need to set up SSH public keys on every rack controller for user <code>maas</code>. First create SSH keys on all rack controllers:</p>
      <pre class="nohighlight"><code>$ sudo -i
      root@maas:~$ mkdir -p /var/snap/maas/current/root/.ssh
      root@maas:~$ cd /var/snap/maas/current/root/.ssh
      root@maas:~$ ssh-keygen -f id_rsa</code></pre>
      <p>Next, add the contents of <code>~maas/.ssh/id_rsa.pub</code> to the VM host user’s <code>~$USER/.ssh/authorized_keys</code>. To accomplish this, log into your VM host node, via SSH, from a host for which MAAS has a matching public SSH key.</p>
      <h2 id="add-a-lxd-vm-host-3.2-ui">Add a LXD VM host (3.2++ UI)</h2>
      <p>To add a LXD VM host with a MAAS-generated certificate, select <em>KVM</em> &gt; <em>LXD</em> &gt; <em>Add KVM</em> and fill in the form:</p>
      <ul>
      <li><p>Enter a <em>Name</em> for the KVM host.</p></li>
      <li><p>Optionally, select a non-default <em>Zone</em>.</p></li>
      <li><p>Optionally, select a non-default <em>Resource pool</em>.</p></li>
      <li><p>Enter the <em>LXD address</em> as the gateway address of the bridge for that LXD instance. For example, if <code>lxdbr0</code> has address <code>10.4.241.0</code>, the default gateway address is <code>10.4.241.1</code>.</p></li>
      <li><p>Select <em>Generate new certificate</em> &gt; <em>Next</em> &gt; <em>Add trust to LXD via command line</em>.</p></li>
      <li><p>Copy the bash command and certificate from the text box, paste it in a terminal and make sure the command runs.</p></li>
      <li><p>Select <em>Check authentication</em>. You’ll switch screens; if all goes well, you’ll see <em>Connected</em> with a green check-mark.</p></li>
      <li><p>Select <em>Add new project</em> or <em>Select existing project</em>. Be aware that if you select an existing project, any VMs already in that project will begin to commission.</p></li>
      </ul>
      <p>Finish by selecting <em>Next</em>. You will drop out to a dashboard for the VM host, from which you can then add virtual machines to this new VM host.</p>
      <h2 id="how-to-add-a-lxd-vm-host-using-an-existing-certificate">How to add a LXD VM host using an existing certificate</h2>
      <p>To use your own existing certificate with a LXD VM host, select <em>KVM</em> &gt; <em>LXD</em> &gt; <em>Add KVM</em> and fill in the form:</p>
      <ul>
      <li><p>Enter a <em>Name</em> for the KVM host.</p></li>
      <li><p>Optionally, select a non-default <em>Zone</em>.</p></li>
      <li><p>Optionally, select a non-default <em>Resource pool</em>.</p></li>
      <li><p>Enter the <em>LXD address</em> as the gateway address of the bridge for that LXD instance. For example, if <code>lxdbr0</code> has address <code>10.4.241.0</code>, the default gateway address is <code>10.4.241.1</code>.</p></li>
      <li><p>Select <em>Provide certificate and private key</em>. The screen will extend.</p></li>
      <li><p><em>Upload a certificate</em> or paste one in the certificate text box.</p></li>
      <li><p><em>Upload a private key</em> or paste on in the private key text box.</p></li>
      <li><p>Select <em>Generate new certificate</em> &gt; <em>Next</em> &gt; <em>Add trust to LXD via command line</em>.</p></li>
      <li><p>Copy the bash command and certificate from the text box, paste it in a terminal and make sure the command runs.</p></li>
      <li><p>Select <em>Check authentication</em>. You’ll switch screens; if all goes well, you’ll see <em>Connected</em> with a green check-mark.</p></li>
      <li><p>Select <em>Add new project</em> or <em>Select existing project</em>. Be aware that if you select an existing project, any VMs already in that project will begin to commission.</p></li>
      </ul>
      <p>Finish by selecting <em>Next</em>. You will drop out to a dashboard for the VM host, from which you can then add virtual machines to this new VM host.</p>
      <h2 id="delete-a-vm-host">Delete a VM host</h2>
      <p>To delete a VM host, select <em>KVM</em> &gt; VM host to delete &gt; <em>KVM host settings</em> &gt; <em>Danger zone</em> &gt; <em>Remove KVM host</em>. You will need to confirm this choice. There is no way to recover the VM host after confirming.</p>
      <h2 id="add-a-vm-host-3.0-ui">Add a VM host (3.0 UI)</h2>
      <p>To add a VM host, select <em>KVM</em> &gt; <em>Add KVM</em> &gt; <em>KVM host type</em>, and fill in the form:</p>
      <ul>
      <li><p>Enter a <em>Name</em> for the KVM host.</p></li>
      <li><p>Optionally, select a non-default <em>Zone</em>.</p></li>
      <li><p>Optionally, select a non-default <em>Resource pool</em>.</p></li>
      <li><p>If you chose the <em>LXD</em> host type, enter the <em>LXD address</em> as the gateway address of the bridge for that LXD instance. For example, if <code>lxdbr0</code> has address <code>10.4.241.0</code>, the default gateway address is <code>10.4.241.1</code>.</p></li>
      <li><p>If you chose the <em>virsh</em> host type, enter the <em>Virsh address</em>, which is of the form <code>qemu+ssh://&lt;vm host IP&gt;/system</code>.</p></li>
      <li><p>Enter any requested passwords, if needed.</p></li>
      <li><p>Select <em>Authenticate</em>. MAAS will drop to a KVM host screen.</p></li>
      </ul>
      <p>You can then add virtual machines to this new VM host as desired.</p>
      <h2 id="add-a-vm-host-3.0-cli">Add a VM host (3.0++ CLI)</h2>
      <p>To add a VM host via the CLI:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host create type=$VM_HOST_TYPE power_address=$POWER_ADDRESS \
          [power_user=$USERNAME] power_pass=$PASSWORD {project=$PROJECT} \
          [zone=$ZONE] [tags=$TAG1,$TAG2,...]</code></pre>
      <p>$VM_HOST_TYPE can currently take two values: <code>virsh</code> and <code>lxd</code>.</p>
      <p>$POWER_ADDRESS typically looks like the following for libvirt:</p>
      <pre><code>qemu+ssh://&lt;vm host IP&gt;/system</code></pre>
      <p>of like this for LXD (Beta):</p>
      <pre><code>https://10.0.0.100:8443</code></pre>
      <p>Both $USERNAME and $PASSWORD are optional for the virsh power type. $ZONE and $TAGS are optional for all VM hosts.</p>
      <p>The <code>power_...</code> parameters will vary with power type.</p>
      <p>For example, to create a LXD VM host, enter the following:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-hosts create type=lxd power_address=$LXD_BRIDGE_ADDRESS \
         power_pass=$LXD_TRUST_PASSWORD project=$PROJECT_NAME</code></pre>
      <p>Note that for LXD VM hosts, a project name is not optional. Project names cannot contain spaces or special characters. If you enter a project name which doesn’t exist, MAAS will create the LXD project for you.</p>
      <h2 id="add-a-vm-host-2.9-cli">Add a VM host (2.9 CLI)</h2>
      <p>To add a VM host via the 2.9 CLI:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host create type=$VM_HOST_TYPE power_address=$POWER_ADDRESS \
          [power_user=$USERNAME] [power_pass=$PASSWORD] [zone=$ZONE] \
          [tags=$TAG1,$TAG2,...]</code></pre>
      <p>$VM_HOST_TYPE can currently take three values: <code>rsd</code>, <code>virsh</code>, and <code>lxd</code>.</p>
      <p>$POWER_ADDRESS typically looks like the following for libvirt:</p>
      <pre><code>qemu+ssh://&lt;vm host IP&gt;/system</code></pre>
      <p>of like this for LXD (Beta):</p>
      <pre><code>https://10.0.0.100:8443</code></pre>
      <p>Both $USERNAME and $PASSWORD are optional for the virsh power type. $ZONE and $TAGS are optional for all VM hosts.</p>
      <p>The <code>power_...</code> parameters will vary with power type. See the <a href="/docs/api#power-types">API reference</a> for a listing of available power types.</p>
      <h2 id="some-examples">Some examples</h2>
      <p>For example, to create an RSD VM host, enter:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-hosts create type=rsd power_address=10.3.0.1:8443 \
          power_user=admin power_pass=admin</code></pre>
      <p>To create a KVM host, enter the following:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-hosts create type=virsh power_address=qemu+ssh://ubuntu@192.168.1.2/system</code></pre>
      <p>MAAS will automatically discover and store the resources your VM host contains. Any existing machines will also appear on the ‘Machines’ page, and MAAS will automatically attempt to commission them.</p>
      <h2 id="configure-a-vm-host-ui">Configure a VM host (UI)</h2>
      <p>To configure a VM host, select <em>KVM</em> &gt; <em>LXD</em> &gt; VM host to configure &gt; <em>KVM host settings</em> and fill out the form:</p>
      <ul>
      <li><p>Optionally set <em>KVM configuration</em> &gt; <em>Zone</em> by selecting from the drop-down.</p></li>
      <li><p>Optionally set the <em>KVM configuration</em> &gt; <em>Resource pool</em> by selecting from the drop-down.</p></li>
      <li><p>Optionally add or change <em>KVM configuration</em> &gt; (Tags*.</p></li>
      <li><p>Optionally change the <em>KVM configuration</em> &gt; <em>CPU overcommit</em> ratio by moving the slider.</p></li>
      <li><p>Optionally change the <em>KVM configuration</em> &gt; <em>Memory overcommit</em> ratio by moving the slider.</p></li>
      </ul>
      <p>If you’ve made changes to this point, select <em>KVM configuration</em> &gt; <em>Save changes</em>. MAAS will save the <em>KVM configuration</em> changes, but will not switch screens. If you need to change the <em>Authentication</em> &gt; <em>Certificate</em>, at this point, you may do so. Make sure to choose <em>Update certificate</em> to register your changes.</p>
      <p>If you want to remove this KVM host, choose <em>Danger zone</em> &gt; <em>Remove KVM host</em>. You will need to confirm this choice.</p>
      <h2 id="list-vm-hosts-cli">List VM hosts (CLI)</h2>
      <p>Using the CLI, it’s possible to update the configuration of a VM host. You can change these configurable parameters with an <code>update</code> command – but first, you’ll want to know how to check the values of configurable parameters, both before and after the change.</p>
      <p>To begin, you can list your available KVM-hosts with the following command:</p>
      <pre class="nohighlight"><code>maas admin vm-hosts read | jq -r &#39;([&quot;ID, &quot;VM-HOST&quot;,&quot;SYSID&quot;,&quot;CORES&quot;,
      &quot;USED&quot;,&quot;RAM&quot;, &quot;USED&quot;,&quot;STORAGE&quot;, &quot;USED&quot;] | (., map(length*&quot;-&quot;))),
      (.[]| [.id,.name,.host.system_id,.total.cores, .used.cores, .total.memory, .used.memory,.total.local_storage, .used.local_storage])
      | @tsv&#39; | column -t</code></pre>
      <h2 id="list-vm-host-params-cli">List VM host params (CLI)</h2>
      <p>There are just a few parameters that you can change for a VM host. You can list these, on a per-host basis, using the following two-step procedure:</p>
      <ol type="1">
      <li><p>Run the command above to get the VM host ID (different from the System ID, see the first column in the listing).</p></li>
      <li><p>Enter the following command to list configurable parameters:</p></li>
      </ol>
      <pre class="nohighlight"><code>maas admin vm-host read $ID | jq -r &#39;([&quot;ID&quot;,&quot;NAME&quot;,&quot;POOL&quot;,&quot;ZONE&quot;,
      &quot;CPU-O/C&quot;, &quot;RAM-O/C&quot;, &quot;TAGS&quot;] | (., map(length*&quot;-&quot;))), (.| [.id,.name,
      .pool.name, .zone.name,.cpu_over_commit_ratio, 
      .memory_over_commit_ratio, .tags[]]) | @tsv&#39; | column -t</code></pre>
      <p>where $ID is the ID (not System ID) of the VM-host.</p>
      <h2 id="change-vm-host-name-cli">Change VM host name (CLI)</h2>
      <p>You can change the VM host’s name very simply, with this command:</p>
      <pre><code>maas admin vm-host update $ID name=$NEW_NAME</code></pre>
      <p>where $ID is the VM host’s ID (not System ID), and $NEW_NAME is the new name you want to assign. You can check that the change was successful by just printing out the ID and name, like this:</p>
      <pre class="nohighlight"><code>maas admin vm-host read $ID | jq -r &#39;([&quot;ID&quot;,&quot;NAME&quot;] 
      | (., map(length*&quot;-&quot;))), (.| [.id,.name]) 
      | @tsv&#39; | column -t</code></pre>
      <h2 id="change-vm-host-pool-cli">Change VM host pool (CLI)</h2>
      <p>You can also change the VM host’s pool with a simple command:</p>
      <pre class="nohighlight"><code>maas admin vm-host update $ID pool=$VALID_POOL</code></pre>
      <p>where $ID is the VM host’s ID (not System ID), and $VALID_POOL is the name of a pool that already exists. If you mention a pool you haven’t created yet, you’ll get an error like this:</p>
      <pre class="nohighlight"><code>{&quot;pool&quot;: [&quot;Select a valid choice. That choice is not one of the available choices.&quot;]}</code></pre>
      <pre class="nohighlight"><code>maas admin resource-pools read | jq -r &#39;.[] | (.name)&#39;</code></pre>
      <p>If you really want to set your VM host to a new one, you just need to create a new one with this command:</p>
      <pre class="nohighlight"><code>maas admin resource-pools create name=$NEW_POOL_NAME</code></pre>
      <p>Then double-check it with <code>catvmpools</code>, and assign your VM host to it using the earlier command.</p>
      <h2 id="list-vm-host-resources-cli">List VM host resources (CLI)</h2>
      <pre class="nohighlight"><code>maas $PROFILE vm-hosts read</code></pre>
      <p>A portion of the sample output:</p>
      <pre class="no-highlight"><code>        &quot;id&quot;: 93,
              &quot;capabilities&quot;: [
                  &quot;composable&quot;,
                  &quot;fixed_local_storage&quot;,
                  &quot;iscsi_storage&quot;
              ],
              &quot;name&quot;: &quot;civil-hermit&quot;,</code></pre>
      <h2 id="list-single-vm-host-resources-cli">List single VM host resources (CLI)</h2>
      <p>To list an individual VM host’s resources:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host read $VM_HOST_ID</code></pre>
      <h2 id="update-vm-host-config-cli">Update VM host config (CLI)</h2>
      <p>Update overcommit ratios for a KVM host:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host update $VM_HOST_ID power_address=qemu+ssh://ubuntu@192.168.1.2/system \
              power_pass=example cpu_over_commit_ratio=2.5 memory_over_commit_ratio=10.0</code></pre>
      <p>Update the default storage pool used by a KVM host:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host update $VM_HOST_ID power_address=qemu+ssh://ubuntu@192.168.1.2/system \
              power_pass=example default_storage_pool=pool2</code></pre>
      <h2 id="vm-host-connection-params-cli">VM host connection params (CLI)</h2>
      <p>To list a VM host’s connection parameters:</p>
      <pre class="nohighlight"><code>maas $PROFILE vm-host parameters $VM_HOST_ID</code></pre>
      <p>Example output:</p>
      <pre class="no-highlight"><code>{
          &quot;power_address&quot;: &quot;10.3.0.1:8443&quot;,
          &quot;power_pass&quot;: &quot;admin&quot;,
          &quot;power_user&quot;: &quot;admin&quot;
      }</code></pre>
      <h2 id="lxd-clusters-3.1">LXD clusters (3.1++)</h2>
      <p>MAAS takes advantage of the existing LXD clustering capability. LXD clusters within the context of MAAS are a way of viewing and managing existing VM host clusters and composing VMs within said cluster. MAAS will not create a new cluster, but will discover an existing cluster when you provide the info for adding a single clustered host.</p>
      <h2 id="add-lxd-clusters-3.1">Add LXD clusters (3.1++)</h2>
      <p>MAAS assumes you have already configured a cluster within the context of LXD. You then need to configure this cluster with a single trust MAAS will use to communicate with said cluster.</p>
      <p>The process of adding a LXD cluster is <a href="#heading--adding-a-vm-host">identical to the procedure for adding a LXD VM host</a>. The only difference is that the name you provide will be used for the cluster instead of the individual host.</p>
      <p>MAAS will then connect to the provided host and discover the other hosts within the cluster, and rename the initially defined host with the cluster member name configured in LXD. The VM host will show up as a <em>Cluster</em> on the dashboard.</p>
      <h2 id="compose-vms-in-lxd-clusters-3.1">Compose VMs in LXD clusters (3.1++)</h2>
      <p>To compose VMs in a LXD cluster, follow the procedure for <a href="how-to-manage-virtual-machines.html">adding a VM to a VM host</a>.</p>
      <h2 id="delete-lxd-clusters-3.1">Delete LXD clusters (3.1++)</h2>
      <p>To delete a LXD cluster, <a href="#heading--deleting-a-vm-host">delete any VM host within the cluster</a>.</p>
      <blockquote>
      <p>This will delete the cluster and <strong>all</strong> members within the cluster. Make sure that’s what you want to do.</p>
      </blockquote>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
