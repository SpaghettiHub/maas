<!DOCTYPE html>
<html>
  <head>
    <title>How to back up MAAS</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to back up MAAS</h1>
      <blockquote>
      <p><em>Errors or typos? Topics missing? Hard to read? <a href="https://docs.google.com/forms/d/e/1FAIpQLScIt3ffetkaKW3gDv6FDk7CfUTNYP_HGmqQotSTtj2htKkVBw/viewform?usp=pp_url&entry.1739714854=https://maas.io/docs/backing-up-maas" target = "_blank">Let us know.</a></em></p>
      </blockquote>
      <p>MAAS uses standard command-line utilities to keep backups simple and familiar.</p>
      <h2 id="clean-reset-backup">Clean reset backup</h2>
      <p>This procedure does a clean reset backup using <code>pg_dumpall</code>. MAAS and PostgreSQL are fully overwritten on restore. You can also do a limited back and restore if other services are sharing your PostgreSQL database.</p>
      <p>Generally, using <code>pg_dumpall</code> for a database dump doesn’t require stopping PostgreSQL. It works with live databases, ensuring consistent backups and minimal service disruption. The PostgreSQL transactional model guarantees dump accuracy. You should be able to keep PostgreSQL running – skipping the <em>optional</em> steps below – but you should stop MAAS first to avoid conflicts during the dump. If you’re concerned at all, just use the optional steps to stop and restart PostgreSQL.</p>
      <p>Please note that the order of steps is important.</p>
      <h2 id="clean-snap-backup">Clean Snap backup</h2>
      <ol type="1">
      <li>Use this command, if needed, to confirm the local PostgreSQL service name:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="2" type="1">
      <li>Create an epoch-stamped directory on your external media to store the backup:</li>
      </ol>
      <pre class="nohighlight"><code>   cd &lt;external-backup-media&gt;/maas-backups/
         mkdir $(date +%s)</code></pre>
      <ol start="3" type="1">
      <li>Backup the database to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres pg_dumpall -c &gt; &quot;&lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_dump.sql&quot;</code></pre>
      <ol start="4" type="1">
      <li>Stop MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap stop maas</code></pre>
      <ol start="5" type="1">
      <li>(Optional) Confirm that no other PostgreSQL sessions are active:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -c  &quot;SELECT * FROM pg_stat_activity&quot;</code></pre>
      <ol start="6" type="1">
      <li>(Optional) Stop PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop postgresql.service</code></pre>
      <ol start="7" type="1">
      <li>Take a snapshot of MAAS and note the snapshot ID:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap save maas</code></pre>
      <ol start="8" type="1">
      <li>Verify the snapshot:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap check-snapshot &lt;snapshot-id&gt;</code></pre>
      <ol start="9" type="1">
      <li>Export the snapshot to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap export-snapshot &lt;snapshot-id&gt; &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_snapshot_&lt;snapshot-id&gt;</code></pre>
      <ol start="10" type="1">
      <li>(Optional) Restart PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl start postgresql.service</code></pre>
      <ol start="11" type="1">
      <li>(Optional) Verify that PostgreSQL is running:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl status postgresql</code></pre>
      <ol start="12" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="clean-snap-restore">Clean Snap restore</h2>
      <ol type="1">
      <li>Stop MAAS to clear any cache:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap stop maas </code></pre>
      <ol start="2" type="1">
      <li>Remove the current MAAS instance:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap remove maas</code></pre>
      <ol start="3" type="1">
      <li>Do a clean restore of the database:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -f &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;dump_epoch&gt;_dump.sql postgres </code></pre>
      <ol start="4" type="1">
      <li>(Optional) Confirm that no other PostgreSQL sessions are active:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -c  &quot;SELECT * FROM pg_stat_activity&quot;</code></pre>
      <ol start="5" type="1">
      <li>(Optional) Stop PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop postgresql.service</code></pre>
      <ol start="6" type="1">
      <li>Import the MAAS snapshot from external media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap import-snapshot &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;snapshot-epoch&gt;_maas_snapshot_&lt;snapshot-id&gt;</code></pre>
      <ol start="7" type="1">
      <li>Restore the MAAS snapshot:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restore &lt;snapshot-id&gt;</code></pre>
      <ol start="8" type="1">
      <li>(Optional) Restart PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl start postgresql.service</code></pre>
      <ol start="9" type="1">
      <li>(Optional) Verify that PostgreSQL is running:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl status postgresql</code></pre>
      <ol start="10" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="clean-package-backup">Clean package backup</h2>
      <ol type="1">
      <li>Use this command, if needed, to confirm the local PostgreSQL service name:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="2" type="1">
      <li>Create an epoch-stamped directory on your external media to store the backup:</li>
      </ol>
      <pre class="nohighlight"><code>   cd &lt;external-backup-media&gt;/maas-backups/
         mkdir $(date +%s)</code></pre>
      <ol start="3" type="1">
      <li>Backup the database to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres pg_dumpall -c &gt; &quot;&lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_dump.sql&quot;</code></pre>
      <ol start="4" type="1">
      <li>Stop MAAS services:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
      <ol start="5" type="1">
      <li>(Optional) Confirm that no other PostgreSQL sessions are active:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -c  &quot;SELECT * FROM pg_stat_activity&quot;</code></pre>
      <ol start="6" type="1">
      <li>(Optional) Stop PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop postgresql.service</code></pre>
      <ol start="7" type="1">
      <li>Write a verified archive of the key MAAS files to your external backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo tar cvpzWf &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_backup.tgz --exclude=/var/lib/maas/boot-resources /etc/maas /var/lib/maas</code></pre>
      <ol start="8" type="1">
      <li>(Optional) Restart PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl start postgresql.service</code></pre>
      <ol start="9" type="1">
      <li>(Optional) Verify that PostgreSQL is running:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl status postgresql</code></pre>
      <ol start="10" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="clean-package-restore">Clean package restore</h2>
      <ol type="1">
      <li><p>(Optional, but recommended if possible) Begin with a fresh Ubuntu install.</p></li>
      <li><p>Make sure the required PostgreSQL version is installed.</p></li>
      <li><p>Use this command, if needed, to confirm the local PostgreSQL service name:</p></li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="4" type="1">
      <li>Do a clean restore of the database:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -f &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;dump_epoch&gt;_dump.sql postgres </code></pre>
      <ol start="5" type="1">
      <li><p>Install <a href="how-to-install-maas.html">MAAS from packages</a>.</p></li>
      <li><p>Once fully operational, stop these MAAS services:</p></li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
      <ol start="7" type="1">
      <li>(Optional) Confirm that no other PostgreSQL sessions are active:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -c  &quot;SELECT * FROM pg_stat_activity&quot;</code></pre>
      <ol start="8" type="1">
      <li>(Optional) Stop PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop postgresql.service</code></pre>
      <ol start="9" type="1">
      <li>Untar the backup to a temporary directory:</li>
      </ol>
      <pre class="nohighlight"><code>   mkdir /tmp/maas_backup
         sudo tar xvzpf &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_backup.tgz -C /tmp/maas_backup</code></pre>
      <ol start="10" type="1">
      <li>Create epoch-stamped backup directories:</li>
      </ol>
      <pre class="nohighlight"><code>   backup_dir=&quot;/var/backups/maas_backup/$(date +%s)&quot;
         sudo mkdir -p &quot;$backup_dir&quot;</code></pre>
      <ol start="11" type="1">
      <li>Move current MAAS directories to backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo mv /etc/maas &quot;$backup_dir/etc_maas&quot;
         sudo mv /var/lib/maas &quot;$backup_dir/var_lib_maas&quot;</code></pre>
      <ol start="12" type="1">
      <li>Restore MAAS configuration from backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo cp -prf /tmp/maas_backup/etc/maas /etc/
         sudo cp -prf /tmp/maas_backup/var/lib/maas /var/lib/</code></pre>
      <ol start="13" type="1">
      <li>Do a clean restore of the database:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql -f &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;dump_epoch&gt;_dump.sql postgres </code></pre>
      <ol start="14" type="1">
      <li>(Optional) Restart PostgreSQL:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl start postgresql.service</code></pre>
      <ol start="15" type="1">
      <li>(Optional) Verify that PostgreSQL is running:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl status postgresql</code></pre>
      <ol start="16" type="1">
      <li>Restart MAAS services:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
      <h2 id="limited-backup">Limited backup</h2>
      <p>For MAAS and PostgreSQL setups which are shared with other services, follow these backup and restore guidelines.</p>
      <h2 id="limited-snap-backup">Limited Snap backup</h2>
      <ol type="1">
      <li>Use this command, if needed, to confirm the local PostgreSQL service name:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="2" type="1">
      <li>Create an epoch-stamped directory on your external media to store the backup:</li>
      </ol>
      <pre class="nohighlight"><code>   cd &lt;external-backup-media&gt;/maas-backups/
         mkdir $(date +%s)</code></pre>
      <ol start="3" type="1">
      <li>Identify the MAAS database that you want to back up:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql
         \l
         # identifying the MAAS database is up to you
         \q </code></pre>
      <ol start="4" type="1">
      <li>Backup the database to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres pg_dump [maas_database_name] &gt; &quot;&lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_only_backup.sql&quot;</code></pre>
      <ol start="5" type="1">
      <li>Stop MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap stop maas</code></pre>
      <ol start="6" type="1">
      <li>Take a snapshot of MAAS and note the snapshot ID:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap save maas</code></pre>
      <ol start="8" type="1">
      <li>Verify the snapshot:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap check-snapshot &lt;snapshot-id&gt;</code></pre>
      <ol start="9" type="1">
      <li>Export the snapshot to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap export-snapshot &lt;snapshot-id&gt; &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_snapshot_&lt;snapshot-id&gt;</code></pre>
      <ol start="10" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="limited-snap-restore">Limited Snap restore</h2>
      <ol type="1">
      <li>Stop MAAS to clear any cache:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap stop maas </code></pre>
      <ol start="2" type="1">
      <li>Remove the current MAAS instance:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap remove maas</code></pre>
      <ol start="3" type="1">
      <li>Do a limited restore of the MAAS database only:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql [maas_database_name] &lt; &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;dump_epoch&gt;_maas_only_backup.sql</code></pre>
      <ol start="4" type="1">
      <li>Import the MAAS snapshot from external media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap import-snapshot &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;snapshot-epoch&gt;_maas_snapshot_&lt;snapshot-id&gt;</code></pre>
      <ol start="5" type="1">
      <li>Restore the MAAS snapshot:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restore &lt;snapshot-id&gt;</code></pre>
      <ol start="6" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="limited-package-backup">Limited package backup</h2>
      <ol type="1">
      <li>Use this command, if needed, to confirm the local PostgreSQL service name:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="2" type="1">
      <li>Create an epoch-stamped directory on your external media to store the backup:</li>
      </ol>
      <pre class="nohighlight"><code>   cd &lt;external-backup-media&gt;/maas-backups/
         mkdir $(date +%s)</code></pre>
      <ol start="3" type="1">
      <li>Identify the MAAS database that you want to back up:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql
         \l
         # identifying the MAAS database is up to you
         \q </code></pre>
      <ol start="4" type="1">
      <li>Backup the database to your external backup media:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres pg_dump [maas_database_name] &gt; &quot;&lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_only_backup.sql&quot;</code></pre>
      <ol start="5" type="1">
      <li>Stop MAAS services:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
      <ol start="6" type="1">
      <li>Write a verified archive of the key MAAS files to your external backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo tar cvpzWf &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_backup.tgz --exclude=/var/lib/maas/boot-resources /etc/maas /var/lib/maas</code></pre>
      <ol start="7" type="1">
      <li>Restart MAAS:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo snap restart maas</code></pre>
      <h2 id="limited-package-restore">Limited package restore</h2>
      <ol type="1">
      <li>Use this command, if needed, to confirm the local PostgreSQL service name:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl list-units --type=service | grep postgres</code></pre>
      <ol start="2" type="1">
      <li>Do a limited restore of the MAAS database only:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo -u postgres psql [maas_database_name] &lt; &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/&lt;dump_epoch&gt;_maas_only_backup.sql</code></pre>
      <ol start="3" type="1">
      <li>Untar the MAAS backup to a temporary directory:</li>
      </ol>
      <pre class="nohighlight"><code>   mkdir /tmp/maas_backup
         sudo tar xvzpf &lt;external-backup-media&gt;/maas-backups/&lt;backup-timestamp&gt;/$(date +%s)_maas_backup.tgz -C /tmp/maas_backup</code></pre>
      <ol start="4" type="1">
      <li>Create epoch-stamped backup directories:</li>
      </ol>
      <pre class="nohighlight"><code>   backup_dir=&quot;/var/backups/maas_backup/$(date +%s)&quot;
         sudo mkdir -p &quot;$backup_dir&quot;</code></pre>
      <ol start="5" type="1">
      <li>Move current MAAS directories to backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo mv /etc/maas &quot;$backup_dir/etc_maas&quot;
         sudo mv /var/lib/maas &quot;$backup_dir/var_lib_maas&quot;</code></pre>
      <ol start="6" type="1">
      <li>Remove the current MAAS installation</li>
      </ol>
      <pre class="nohighlight"><code>   sudo apt-get remove --purge maas
         sudo apt-get autoremove</code></pre>
      <ol start="6" type="1">
      <li><p>Install <a href="how-to-install-maas.html">MAAS from packages</a>.</p></li>
      <li><p>Once fully operational, stop these MAAS services:</p></li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
      <ol start="8" type="1">
      <li>Restore MAAS configuration from backup:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo cp -prf /tmp/maas_backup/etc/maas /etc/
         sudo cp -prf /tmp/maas_backup/var/lib/maas /var/lib/</code></pre>
      <ol start="9" type="1">
      <li>Restart MAAS services:</li>
      </ol>
      <pre class="nohighlight"><code>   sudo systemctl stop maas-dhcpd.service
         sudo systemctl stop maas-rackd.service
         sudo systemctl stop maas-regiond.service</code></pre>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
