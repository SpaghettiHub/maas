<!DOCTYPE html>
<html>
  <head>
    <title>How to create custom storage</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>How to create custom storage</h1>
      <p>This page explains how to configure custom storage layouts for MAAS-deployed machines. Note that custom storage is only available for MAAS versions 3.1 and higher.</p>
      <p>MAAS version 3.1 and higher allow you to define a custom storage layout for a machine, via a custom commissioning script. You must upload a script which conforms to the following rules:</p>
      <ul>
      <li>it must run after the <code>40-maas-01-machine-resources</code> script and before the <code>50-maas-01-commissioning</code> one, so it should have a name that starts with anything between <code>41-</code> and <code>49-</code>. This ensures the script can access the JSON file created by the former which provides info about the machine hardware and network resources. In addition, the custom script can directly inspect the machine it’s running on to determine how to configure storage.</li>
      <li>it can read machine hardware/network information from the JSON file at the path specified by <code>$MAAS_RESOURCES_FILE</code></li>
      <li>it must output a JSON file at the path specified by <code>$MAAS_STORAGE_CONFIG_FILE</code> with the desired storage layout</li>
      <li>names of disks provided in the custom layout must match the ones detected by MAAS and provided in the resources file.</li>
      </ul>
      <h2 id="config-format">Config format</h2>
      <p>The configuration contains two main sections: - <code>layout</code>, which lists the desired storage layout in terms of disks and volumes, along with their setup (partitions, volumes, …). This consists of a dictionary of device names and their configuration. Each device must have a <code>type</code> property (see below for supported types). - <code>mounts</code>, which lists the desired filesystem mount points. As an example:</p>
      <pre class="nohighlight"><code>&quot;mounts&quot;: {
        &quot;/&quot;: {
          &quot;device&quot;: &quot;sda2&quot;,
          &quot;options&quot;: &quot;noatime&quot;
        },
        &quot;/boot/efi&quot;: {
          &quot;device&quot;: &quot;sda1&quot;
        },
        &quot;/data&quot;: {
          &quot;device&quot;: &quot;raid0&quot;
        }     
      }</code></pre>
      <p>A complete <code>$MAAS_STORAGE_CONFIG_FILE</code> would look like this:</p>
      <pre class="nohighlight"><code>{
          &quot;layouts&quot;: {
              &quot;sda&quot;: {
                 ...
              },
              &quot;raid0&quot;: {
                 ...
              },
              ...
          },
          &quot;mounts&quot;: {
             &quot;/&quot;: {
                 ...
             },
             ...
          }
      }</code></pre>
      <p>The following device types are supported in the <code>"layout"</code> section:</p>
      <h2 id="disk">Disk</h2>
      <pre class="nohighlight"><code>&quot;sda&quot;: {
        &quot;type&quot;: &quot;disk&quot;,
        &quot;ptable&quot;: &quot;gpt&quot;,
        &quot;boot&quot;: true,
        &quot;partitions&quot;: [
          {
            &quot;name&quot;: &quot;sda1&quot;,
            &quot;fs&quot;: &quot;vfat&quot;,
            &quot;size&quot;: &quot;100M&quot;
            &quot;bootable&quot;: true,
          }
        ]
      }</code></pre>
      <p>A <code>disk</code> entry defines a physical disk. The following details can be specified: - the partition table type (<code>ptable</code>), which can be <code>gpt</code> or <code>mbr</code> - whether it should be selected as <code>boot</code> disk - optionally, a list of partitions to create, with their <code>size</code> and filesystem type (<code>fs</code>)</p>
      <h2 id="lvm">LVM</h2>
      <pre class="nohighlight"><code>&quot;lvm0&quot;: {
        &quot;type&quot;: &quot;lvm&quot;,
        &quot;members&quot;: [
          &quot;sda1&quot;,
          &quot;sdb1&quot;,
        ],
        &quot;volumes&quot;: [
          {
            &quot;name&quot;: &quot;data1&quot;,
            &quot;size&quot;: &quot;5G&quot;,
            &quot;fs&quot;: &quot;ext4&quot;
          },
          {
            &quot;name&quot;: &quot;data2&quot;,
            &quot;size&quot;: &quot;7G&quot;,
            &quot;fs&quot;: &quot;btrfs&quot;
          }
        ]
      }</code></pre>
      <p>An <code>lvm</code> entry defines a VG (volume group) composed by a set of disks or partitions (listed as <code>members</code>). Optionally it’s possible to specify the the LVs (logical volumes) to create. Those are defined similarly to partitions, with a name and size (and optionally the filesystem).</p>
      <h2 id="bcache">Bcache</h2>
      <pre class="nohighlight"><code>&quot;bcache0&quot;: {
        &quot;type&quot;: &quot;bcache&quot;,
        &quot;cache-device&quot;: &quot;sda&quot;,
        &quot;backing-device&quot;: &quot;sdf3&quot;,
        &quot;cache-mode&quot;: &quot;writeback&quot;,
        &quot;fs&quot;: &quot;ext4&quot;
      }</code></pre>
      <p>A <code>bcache</code> entry must specify a device to use as cache and one to use as storage. Both can be either a partition or a disk. Optionally the <code>cache-mode</code> for the Bcache can be specified.</p>
      <h2 id="raid">RAID</h2>
      <pre class="nohighlight"><code>&quot;myraid&quot;: {
        &quot;type&quot;: &quot;raid&quot;,
        &quot;level&quot;: 5,
        &quot;members&quot;: [
          &quot;sda&quot;,
          &quot;sdb&quot;,
          &quot;sdc&quot;,
        ],
        &quot;spares&quot;: [
          &quot;sdd&quot;,
          &quot;sde&quot;
        ],
        &quot;fs&quot;: &quot;btrfs&quot;</code></pre>
      <p>A <code>raid</code> entry defines a RAID with a set of member devices. Spare devices can also be specified.</p>
      <h2 id="config-examples">Config examples</h2>
      <p>Here’s a few examples of custom storage layout configurations that a script could output to the <code>$MAAS_STORAGE_CONFIG_FILE</code>. The examples assumes that the machine has 5 disks (named <code>sda</code> to <code>sde</code>).</p>
      <p>Note that there’s no need to add entries for those devices in the <code>layout</code> section if the disks are not explicitly partitioned, but just used by other devices (e.g. RAID or LVM).</p>
      <h2 id="simple-single-disk-layout-with-gpt-partitioning">Simple single-disk layout with GPT partitioning</h2>
      <pre class="nohighlight"><code>{
        &quot;layout&quot;: {
          &quot;sda&quot;: {
            &quot;type&quot;: &quot;disk&quot;,
            &quot;ptable&quot;: &quot;gpt&quot;,
            &quot;boot&quot;: true,
            &quot;partitions&quot;: [
              {
                &quot;name&quot;: &quot;sda1&quot;,
                &quot;fs&quot;: &quot;vfat&quot;,
                &quot;size&quot;: &quot;500M&quot;,
                &quot;bootable&quot;: true
              },
              {
                &quot;name&quot;: &quot;sda2&quot;,
                &quot;size&quot;: &quot;5G&quot;,
                &quot;fs&quot;: &quot;ext4&quot;
              },
              {
                &quot;name&quot;: &quot;sda3&quot;,
                &quot;size&quot;: &quot;2G&quot;,
                &quot;fs&quot;: &quot;swap&quot;
              },
              {
                &quot;name&quot;: &quot;sda4&quot;,
                &quot;size&quot;: &quot;120G&quot;,
                &quot;fS&quot;: &quot;ext4&quot;
              }
            ]
          }
        },
        &quot;mounts&quot;: {
          &quot;/&quot;: {
            &quot;device&quot;: &quot;sda2&quot;,
            &quot;options&quot;: &quot;noatime&quot;
          },
          &quot;/boot/efi&quot;: {
            &quot;device&quot;: &quot;sda1&quot;
          },
          &quot;/data&quot;: {
            &quot;device&quot;: &quot;sda4&quot;
          },
          &quot;none&quot;: {
            &quot;device&quot;: &quot;sda3&quot;
          }
        }
      }</code></pre>
      <p>In the <code>mounts</code> section, options for mount points can be specified. For swap, an entry must be present (with any unique name that doesn’t start with a <code>/</code>), otherwise the swap will be created but not activated.</p>
      <h2 id="raid-5-setup-with-spare-devices">RAID 5 setup (with spare devices)</h2>
      <pre class="nohighlight"><code>{
        &quot;layout&quot;: {
          &quot;storage&quot;: {
            &quot;type&quot;: &quot;raid&quot;,
            &quot;level&quot;: 5,
            &quot;members&quot;: [
              &quot;sda&quot;,
              &quot;sdb&quot;,
              &quot;sdc&quot;
            ],
            &quot;spares&quot;: [
              &quot;sdd&quot;,
              &quot;sde&quot;
            ],
            &quot;fs&quot;: &quot;btrfs&quot;
          }
        },
        &quot;mounts&quot;: {
          &quot;/data&quot;: {
            &quot;device&quot;: &quot;storage&quot;
          }
        }
      }</code></pre>
      <p>Both full disks and partitions can be used as RAID members.</p>
      <h2 id="lvm-with-pre-defined-volumes">LVM with pre-defined volumes</h2>
      <pre class="nohighlight"><code>{
        &quot;layout&quot;: {
          &quot;storage&quot;: {
            &quot;type&quot;: &quot;lvm&quot;,
            &quot;members&quot;: [
              &quot;sda&quot;,
              &quot;sdb&quot;,
              &quot;sdc&quot;,
              &quot;sdd&quot;
            ],
            &quot;volumes&quot;: [
              {
                &quot;name&quot;: &quot;data1&quot;,
                &quot;size&quot;: &quot;1T&quot;,
                &quot;fs&quot;: &quot;ext4&quot;
              },
              {
                &quot;name&quot;: &quot;data2&quot;,
                &quot;size&quot;: &quot;2.5T&quot;,
                &quot;fs&quot;: &quot;btrfs&quot;
              }
            ]
          }
        },
        &quot;mounts&quot;: {
          &quot;/data1&quot;: {
            &quot;device&quot;: &quot;data1&quot;
          },
          &quot;/data2&quot;: {
            &quot;device&quot;: &quot;data2&quot;
          }
        }
      }</code></pre>
      <p>If no volumes are specified, the volume group is still created.</p>
      <h2 id="bcache-1">Bcache</h2>
      <pre class="nohighlight"><code>{
        &quot;layout&quot;: {
           &quot;data1&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;cache-device&quot;: &quot;sda&quot;,
            &quot;backing-device&quot;: &quot;sdb&quot;,
            &quot;cache-mode&quot;: &quot;writeback&quot;,
            &quot;fs&quot;: &quot;ext4&quot;
          },
          &quot;data2&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;cache-device&quot;: &quot;sda&quot;,
            &quot;backing-device&quot;: &quot;sdc&quot;,
            &quot;fs&quot;: &quot;btrfs&quot;
          }
        },
        &quot;mounts&quot;: {
          &quot;/data1&quot;: {
            &quot;device&quot;: &quot;data1&quot;
          },
          &quot;/data2&quot;: {
            &quot;device&quot;: &quot;data2&quot;
          }
        }
      }</code></pre>
      <p>The same cache set can be used by different bcaches by specifying the same <code>backing-device</code> for them.</p>
      <h2 id="lvm-on-top-of-raid-with-bcache">LVM on top of RAID with Bcache</h2>
      <pre class="nohighlight"><code>{
        &quot;layout&quot;: {
          &quot;bcache0&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;backing-device&quot;: &quot;sda&quot;,
            &quot;cache-device&quot;: &quot;sdf&quot;
          },
          &quot;bcache1&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;backing-device&quot;: &quot;sdb&quot;,
            &quot;cache-device&quot;: &quot;sdf&quot;
          },
          &quot;bcache2&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;backing-device&quot;: &quot;sdc&quot;,
            &quot;cache-device&quot;: &quot;sdf&quot;
          },
          &quot;bcache3&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;backing-device&quot;: &quot;sdd&quot;,
            &quot;cache-device&quot;: &quot;sdf&quot;
          },
          &quot;bcache4&quot;: {
            &quot;type&quot;: &quot;bcache&quot;,
            &quot;backing-device&quot;: &quot;sde&quot;,
            &quot;cache-device&quot;: &quot;sdf&quot;
          },
          &quot;raid&quot;: {
            &quot;type&quot;: &quot;raid&quot;,
            &quot;level&quot;: 5,
            &quot;members&quot;: [
              &quot;bcache0&quot;,
              &quot;bcache1&quot;,
              &quot;bcache2&quot;
            ],
            &quot;spares&quot;: [
              &quot;bcache3&quot;,
              &quot;bcache4&quot;
            ]
          },
          &quot;lvm&quot;: {
            &quot;type&quot;: &quot;lvm&quot;,
            &quot;members&quot;: [
              &quot;raid&quot;
            ],
            &quot;volumes&quot;: [
              {
                &quot;name&quot;: &quot;root&quot;,
                &quot;size&quot;: &quot;10G&quot;,
                &quot;fs&quot;: &quot;ext4&quot;
              },
              {
                &quot;name&quot;: &quot;data&quot;,
                &quot;size&quot;: &quot;3T&quot;,
                &quot;fs&quot;: &quot;btrfs&quot;
              }
            ]
          }
        },
        &quot;mounts&quot;: {
         &quot;/&quot;: {
            &quot;device&quot;: &quot;root&quot;
          },
          &quot;/data&quot;: {
            &quot;device&quot;: &quot;data&quot;
          }
        }
      }</code></pre>
      <p>The RAID is created by using 5 bcache devices, each one using a different disk and the same SSD cache device. LVM is created on top of the RAID device and volumes are then created in it, to provide partitions.</p>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
